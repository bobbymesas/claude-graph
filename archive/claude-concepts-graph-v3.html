<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claude Code Concepts Graph</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: #0d1117;
  color: #e6edf3;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  height: 100vh;
  overflow: hidden;
  display: flex;
}

/* GRAPH AREA */
#graph-area {
  flex: 1;
  position: relative;
  transition: margin-right 0.35s cubic-bezier(.4,0,.2,1);
}
canvas { display: block; width: 100%; height: 100%; }

/* HOVER TOOLTIP */
#tooltip {
  position: fixed;
  background: #161b22;
  border: 1px solid #30363d;
  border-radius: 10px;
  padding: 12px 16px;
  max-width: 220px;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.12s;
  z-index: 50;
  box-shadow: 0 6px 24px rgba(0,0,0,0.6);
}
#tooltip h3 { font-size: 13px; margin-bottom: 4px; color: #fff; }
#tooltip p { font-size: 11px; color: #8b949e; line-height: 1.5; }
#tooltip .tt-hint { font-size: 10px; color: #484f58; margin-top: 6px; }

/* SIDE PANEL */
#side-panel {
  width: 0;
  overflow: hidden;
  background: #0d1117;
  border-left: 1px solid #21262d;
  display: flex;
  flex-direction: column;
  transition: width 0.35s cubic-bezier(.4,0,.2,1);
  flex-shrink: 0;
}
#side-panel.open { width: 420px; }
#panel-inner {
  width: 420px;
  height: 100vh;
  overflow-y: auto;
  padding: 28px 24px 40px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}
#panel-inner::-webkit-scrollbar { width: 6px; }
#panel-inner::-webkit-scrollbar-track { background: transparent; }
#panel-inner::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }

/* Panel header */
#panel-header { display: flex; align-items: flex-start; justify-content: space-between; gap: 12px; }
#panel-title { font-size: 20px; font-weight: 600; color: #fff; line-height: 1.3; }
#panel-close {
  background: none; border: 1px solid #30363d; border-radius: 6px;
  color: #8b949e; cursor: pointer; padding: 4px 8px; font-size: 16px;
  flex-shrink: 0; line-height: 1;
  transition: border-color 0.15s, color 0.15s;
}
#panel-close:hover { border-color: #8b949e; color: #fff; }

/* Badges */
#panel-badges { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
.badge {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 500;
  border: 1px solid;
}
.badge-user { background: #0d2436; border-color: #1f6feb; color: #58a6ff; }
.badge-claude { background: #1a1f2e; border-color: #6e40c9; color: #d2a8ff; }
.badge-both { background: #1c2418; border-color: #3fb950; color: #56d364; }
.badge-system { background: #1c1f1a; border-color: #4a4f45; color: #848d79; }
.badge-cat {
  padding: 4px 10px; border-radius: 20px; font-size: 11px;
  border: 1px solid; font-weight: 500;
}

/* Description */
#panel-desc { font-size: 13px; color: #c9d1d9; line-height: 1.7; }

/* Doc link */
#panel-doclink a {
  display: inline-flex; align-items: center; gap: 6px;
  color: #58a6ff; font-size: 12px; text-decoration: none;
  border: 1px solid #1f6feb44; border-radius: 6px; padding: 6px 12px;
  background: #0d2436;
  transition: background 0.15s, border-color 0.15s;
}
#panel-doclink a:hover { background: #122d47; border-color: #1f6feb; }
#panel-doclink a svg { flex-shrink: 0; }

/* Code block */
.code-toggle {
  border: 1px solid #30363d; border-radius: 8px; overflow: hidden;
}
.code-toggle-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 14px; background: #161b22; cursor: pointer;
  user-select: none;
}
.code-toggle-header:hover { background: #1c2128; }
.code-toggle-label { font-size: 12px; color: #8b949e; display: flex; align-items: center; gap: 6px; }
.code-toggle-label .filename { color: #c9d1d9; font-family: 'SF Mono', 'Fira Code', monospace; font-size: 11px; }
.code-toggle-chevron { font-size: 10px; color: #484f58; transition: transform 0.2s; }
.code-toggle-chevron.open { transform: rotate(90deg); }
.code-toggle-body {
  max-height: 0; overflow: hidden;
  transition: max-height 0.3s cubic-bezier(.4,0,.2,1);
  background: #0d1117;
}
.code-toggle-body.open { max-height: 600px; }
pre {
  padding: 14px 16px; overflow-x: auto; font-size: 11.5px;
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
  line-height: 1.65; color: #e6edf3;
}
pre::-webkit-scrollbar { height: 4px; }
pre::-webkit-scrollbar-thumb { background: #30363d; border-radius: 2px; }

/* Relations */
#panel-related h4 { font-size: 11px; color: #8b949e; text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 10px; }
.related-chips { display: flex; flex-wrap: wrap; gap: 6px; }
.related-chip {
  padding: 4px 10px; border-radius: 6px; font-size: 11px;
  border: 1px solid #30363d; color: #8b949e; cursor: pointer;
  transition: border-color 0.15s, color 0.15s;
  background: #161b22;
}
.related-chip:hover { border-color: #58a6ff; color: #58a6ff; }

/* Legend */
#legend {
  position: fixed; bottom: 20px; left: 20px;
  background: #161b22; border: 1px solid #21262d;
  border-radius: 10px; padding: 12px 16px; font-size: 11px;
  z-index: 10;
}
#legend h4 { color: #484f58; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.05em; font-size: 9px; }
.legend-item { display: flex; align-items: center; gap: 7px; margin-bottom: 5px; }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }

/* Top bar */
#topbar {
  position: fixed; top: 0; left: 0; right: 0; height: 44px;
  background: #0d1117; border-bottom: 1px solid #21262d;
  display: flex; align-items: center; padding: 0 20px; gap: 12px;
  z-index: 20;
}
#topbar-title { font-size: 13px; color: #8b949e; letter-spacing: 0.04em; }
#topbar-sep { color: #30363d; }
#topbar-hint { font-size: 11px; color: #484f58; }
#canvas-wrap { position: absolute; inset: 44px 0 0; }
</style>
</head>
<body>

<div id="topbar">
  <span id="topbar-title">Claude Code Â· Concept Map</span>
  <span id="topbar-sep">Â·</span>
  <span id="topbar-hint">Hover to preview Â· Click for full details</span>
</div>

<div id="graph-area">
  <div id="canvas-wrap"><canvas id="c"></canvas></div>
</div>

<div id="side-panel">
  <div id="panel-inner">
    <div id="panel-header">
      <div id="panel-title"></div>
      <button id="panel-close">âœ•</button>
    </div>
    <div id="panel-badges"></div>
    <div id="panel-desc"></div>
    <div id="panel-doclink"></div>
    <div id="panel-examples"></div>
    <div id="panel-related"></div>
  </div>
</div>

<div id="tooltip">
  <h3 id="tt-title"></h3>
  <p id="tt-desc"></p>
  <p class="tt-hint">Click for full details â†’</p>
</div>

<div id="legend">
  <h4>Category</h4>
  <div class="legend-item"><div class="legend-dot" style="background:#f78166"></div>Core</div>
  <div class="legend-item"><div class="legend-dot" style="background:#d2a8ff"></div>Extensibility</div>
  <div class="legend-item"><div class="legend-dot" style="background:#79c0ff"></div>Distribution</div>
  <div class="legend-item"><div class="legend-dot" style="background:#56d364"></div>Configuration</div>
  <div class="legend-item"><div class="legend-dot" style="background:#e3b341"></div>Integration</div>
</div>

<script>
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const COLORS = {
  core: '#f78166',
  extensibility: '#d2a8ff',
  distribution: '#79c0ff',
  config: '#56d364',
  integration: '#e3b341',
};

const CAT_LABELS = {
  core: 'Core', extensibility: 'Extensibility',
  distribution: 'Distribution', config: 'Configuration', integration: 'Integration'
};

// initiated: 'user' | 'claude' | 'both' | 'system'
const nodes = [
  {
    id: 'claude-code', label: 'Claude Code', cat: 'core', r: 40,
    initiated: 'both',
    short: 'The main AI coding assistant. Everything else extends or configures it.',
    desc: 'Claude Code is Anthropic\'s agentic coding assistant. It can read, edit, and reason about your codebase, run commands, browse docs, and delegate tasks to subagents â€” all from a terminal or web interface.',
    doc: 'https://code.claude.com/docs/en/overview',
    docLabel: 'Claude Code overview',
    examples: [
      {
        filename: 'Repo structure',
        label: 'Where Claude Code config lives',
        code: `.claude/
â”œâ”€â”€ settings.json        â† behavior, hooks, plugins
â”œâ”€â”€ CLAUDE.md            â† project context Claude always reads
â”œâ”€â”€ agents/              â† custom subagent definitions
â”‚   â””â”€â”€ code-reviewer.md
â”œâ”€â”€ skills/              â† Agent Skills (model-invoked)
â”‚   â””â”€â”€ pdf-processing/SKILL.md
â””â”€â”€ rules/               â† reusable rule snippets
    â””â”€â”€ code-style.md
.mcp.json                â† MCP server config`,
      },
      {
        filename: '.claude/CLAUDE.md',
        label: 'CLAUDE.md â€” project context',
        code: `# My Project

Always read \`.claude/rules/code-style.md\` before writing code.

## Stack
- TypeScript, React, Node 20
- Postgres via Drizzle ORM
- Vitest for tests

## Conventions
- API routes live in \`src/routes/\`
- Use named exports, never default exports
- Run \`npm test\` before marking any task done`,
      },
    ],
  },
  {
    id: 'agent', label: 'Agent', cat: 'core', r: 30,
    initiated: 'both',
    short: 'A pre-configured AI personality for a specific task domain.',
    desc: 'Agents are pre-configured AI personalities with custom system prompts, tool access, and their own context window. Claude Code can delegate tasks to them automatically or you can invoke them explicitly with "Use the X agent toâ€¦".',
    doc: 'https://code.claude.com/docs/en/sub-agents',
    docLabel: 'Subagents docs',
    examples: [
      {
        filename: 'Repo structure',
        label: 'Where agent files live',
        code: `.claude/
â””â”€â”€ agents/
    â”œâ”€â”€ code-reviewer.md   â† project-level, shared via git
    â””â”€â”€ debugger.md
~/.claude/agents/
    â””â”€â”€ personal.md        â† user-level, all projects`,
      },
      {
        filename: '.claude/agents/code-reviewer.md',
        label: 'Example: Code Reviewer agent',
        code: `---
name: code-reviewer
description: Reviews code for best practices, security, and
  performance. Invoked automatically after code changes or
  when asked to review.
tools: Read, Grep, Glob
model: sonnet
---

You are a senior code reviewer. For every review:

1. Check code organization and structure
2. Look for error handling gaps
3. Flag security concerns (injections, secrets in source)
4. Suggest performance improvements
5. Verify test coverage exists

Group findings by severity: Critical / Warning / Info.`,
      },
      {
        filename: '.claude/agents/debugger.md',
        label: 'Example: Debugger agent',
        code: `---
name: debugger
description: Diagnoses bugs and runtime errors. Use when
  something is broken and you need root-cause analysis.
tools: Read, Bash, Grep, Glob
model: opus
---

You are an expert debugger. When given a bug:

1. Reproduce the error with minimal steps
2. Trace the execution path to find root cause
3. Propose a fix with explanation of why it works
4. Add a regression test to prevent recurrence

Never guess â€” gather evidence first.`,
      },
    ],
  },
  {
    id: 'subagent', label: 'Subagent\n(Task tool)', cat: 'core', r: 24,
    initiated: 'claude',
    short: 'A child agent Claude autonomously spawns to handle a subtask.',
    desc: 'When Claude Code uses the Task tool, it spins up a subagent with its own isolated context window. Subagents work independently and return results to the parent â€” preventing context pollution and enabling parallel work.',
    doc: 'https://code.claude.com/docs/en/sub-agents#what-are-subagents',
    docLabel: 'Subagents docs',
    examples: [
      {
        filename: '.claude/agents/data-analyst.md',
        label: 'Example agent Claude auto-delegates to',
        code: `---
name: data-analyst
description: Analyzes CSV and JSON datasets, produces
  summaries and charts. Invoked automatically when working
  with data files or asked to analyze tabular data.
tools: Read, Bash, Glob
model: sonnet
skills: python-data-analysis
---

You are a data analyst. When given a dataset:

1. Inspect structure and data types first
2. Identify missing values and outliers
3. Compute summary statistics
4. Generate a Markdown summary with key findings
5. Suggest follow-up analyses if useful`,
      },
    ],
  },
  {
    id: 'headless', label: 'Headless\nMode', cat: 'core', r: 22,
    initiated: 'user',
    short: 'Run Claude Code non-interactively â€” for CI/CD and scripting.',
    desc: 'Headless mode lets you run Claude Code without a UI via the CLI, making it ideal for automation, CI pipelines, and scripts. Pass a prompt with -p and pipe output to other tools.',
    doc: 'https://code.claude.com/docs/en/headless',
    docLabel: 'Headless mode docs',
    examples: [
      {
        filename: 'shell',
        label: 'Example: Headless CLI usage',
        code: `# One-shot prompt
claude -p "Fix all TypeScript errors in src/"

# Pipe a diff for review
git diff HEAD~1 | claude -p "Flag any security issues in this diff"

# JSON output for scripting
claude -p "List all TODO comments" --output-format json | jq .

# Use in a CI step
claude -p "Run tests and fix any failures" --allowedTools Bash,Read,Edit`,
      },
      {
        filename: '.github/workflows/review.yml',
        label: 'Example: GitHub Actions CI step',
        code: `- name: Claude Code review
  run: |
    claude -p "Review the PR diff for security issues.
    Output a Markdown summary." \\
    --output-format text \\
    > review.md
  env:
    ANTHROPIC_API_KEY: \${{ secrets.ANTHROPIC_API_KEY }}`,
      },
    ],
  },
  {
    id: 'plugin', label: 'Plugin', cat: 'extensibility', r: 34,
    initiated: 'user',
    short: 'A shareable bundle of commands, agents, skills, hooks, and MCP servers.',
    desc: 'Plugins extend Claude Code with custom functionality packaged as a directory. They can include slash commands, subagent definitions, Agent Skills, hooks, and MCP server configs â€” all shareable via a marketplace.',
    doc: 'https://code.claude.com/docs/en/plugins',
    docLabel: 'Plugins docs',
    examples: [
      {
        filename: 'Plugin directory structure',
        label: 'Standard plugin layout',
        code: `my-plugin/
â”œâ”€â”€ .claude-plugin/
â”‚   â””â”€â”€ plugin.json       â† manifest (required)
â”œâ”€â”€ commands/
â”‚   â””â”€â”€ deploy.md         â† slash commands
â”œâ”€â”€ agents/
â”‚   â””â”€â”€ deployer.md       â† subagent definitions
â”œâ”€â”€ skills/
â”‚   â””â”€â”€ k8s/SKILL.md      â† Agent Skills
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ hooks.json        â† lifecycle hooks
â””â”€â”€ .mcp.json             â† MCP server config`,
      },
      {
        filename: '.claude-plugin/plugin.json',
        label: 'Plugin manifest',
        code: `{
  "name": "deploy-toolkit",
  "version": "1.0.0",
  "description": "Kubernetes deployment commands and agents",
  "author": { "name": "My Org", "email": "dev@example.com" },
  "license": "MIT",
  "keywords": ["kubernetes", "deployment", "ci-cd"]
}`,
      },
    ],
  },
  {
    id: 'command', label: 'Slash\nCommand', cat: 'extensibility', r: 24,
    initiated: 'user',
    short: 'A custom /command you type explicitly to trigger a workflow.',
    desc: 'Slash commands are user-invoked â€” you type /command-name to run them. Defined as Markdown files, Claude reads the file and follows its instructions when you invoke the command. Project commands live in .claude/commands/.',
    doc: 'https://code.claude.com/docs/en/slash-commands',
    docLabel: 'Slash commands docs',
    examples: [
      {
        filename: 'Repo structure',
        label: 'Where slash commands live',
        code: `.claude/
â””â”€â”€ commands/
    â”œâ”€â”€ review.md          â† /review
    â”œâ”€â”€ deploy.md          â† /deploy
    â””â”€â”€ standup.md         â† /standup`,
      },
      {
        filename: '.claude/commands/review.md',
        label: 'Example: /review command',
        code: `---
description: Run a full code review on staged changes
---

# Code Review

1. Run \`git diff --staged\` to see what's changing
2. For each changed file, check:
   - Logic correctness
   - Error handling
   - Security concerns
   - Test coverage
3. Summarize findings by severity: Critical / Warning / Info
4. Suggest specific fixes with file and line references`,
      },
      {
        filename: '.claude/commands/standup.md',
        label: 'Example: /standup command',
        code: `---
description: Generate a standup summary from recent git activity
---

# Daily Standup

1. Run \`git log --since="24 hours ago" --oneline --author=$(git config user.email)\`
2. Group commits by feature area
3. Output a Markdown standup summary:
   - **Yesterday**: what was completed
   - **Today**: what's planned (infer from open TODOs)
   - **Blockers**: note any failing tests or open issues`,
      },
    ],
  },
  {
    id: 'skill', label: 'Agent\nSkill', cat: 'extensibility', r: 26,
    initiated: 'claude',
    short: 'Claude autonomously decides when to use this based on your request.',
    desc: 'Agent Skills are model-invoked â€” you don\'t call them, Claude does. Each skill is a folder with a SKILL.md file whose description tells Claude when to activate it. When your request matches, Claude reads the instructions and follows them.',
    doc: 'https://code.claude.com/docs/en/skills',
    docLabel: 'Agent Skills docs',
    examples: [
      {
        filename: 'Repo structure',
        label: 'Where skills live',
        code: `.claude/
â””â”€â”€ skills/
    â”œâ”€â”€ commit-helper/
    â”‚   â””â”€â”€ SKILL.md       â† auto-used when writing commits
    â”œâ”€â”€ pdf-processing/
    â”‚   â”œâ”€â”€ SKILL.md
    â”‚   â””â”€â”€ scripts/
    â”‚       â””â”€â”€ extract.py
    â””â”€â”€ api-docs/
        â”œâ”€â”€ SKILL.md
        â””â”€â”€ reference.md
~/.claude/skills/          â† personal skills (all projects)`,
      },
      {
        filename: '.claude/skills/commit-helper/SKILL.md',
        label: 'Example: Commit message skill',
        code: `---
name: generating-commit-messages
description: Generates clear, conventional commit messages
  from git diffs. Use when writing commit messages or
  reviewing staged changes.
---

# Generating Commit Messages

## Instructions

1. Run \`git diff --staged\` to see changes
2. Identify type: feat / fix / chore / docs / refactor / test
3. Write a summary under 50 characters
4. Add a body explaining *why*, not just *what*

## Format
\`\`\`
<type>(<scope>): <summary under 50 chars>

<body: explain motivation and impact>

Affects: <list of components>
\`\`\``,
      },
      {
        filename: '.claude/skills/pdf-processing/SKILL.md',
        label: 'Example: PDF processing skill',
        code: `---
name: pdf-processing
description: Extract text, fill forms, merge PDFs. Use when
  working with PDF files, forms, or document extraction.
  Requires pypdf and pdfplumber.
allowed-tools: Read, Bash
---

# PDF Processing

## Quick start

\`\`\`python
import pdfplumber
with pdfplumber.open("doc.pdf") as pdf:
    text = pdf.pages[0].extract_text()
print(text)
\`\`\`

For form filling, see [scripts/extract.py](scripts/extract.py).

## Requirements
\`pip install pypdf pdfplumber\``,
      },
    ],
  },
  {
    id: 'hook', label: 'Hook', cat: 'extensibility', r: 23,
    initiated: 'system',
    short: 'Runs automatically on Claude Code lifecycle events.',
    desc: 'Hooks fire on events like PreToolUse, PostToolUse, Stop, SessionStart, and UserPromptSubmit. They can allow/deny actions, inject context, run formatters, send notifications, or validate commands â€” all without user interaction.',
    doc: 'https://code.claude.com/docs/en/hooks-guide',
    docLabel: 'Hooks guide',
    examples: [
      {
        filename: 'Repo structure',
        label: 'Where hooks are configured',
        code: `.claude/
â””â”€â”€ settings.json          â† hooks live in "hooks" key
    (or settings.local.json for personal-only hooks)`,
      },
      {
        filename: '.claude/settings.json',
        label: 'Example: Format on write + validate prompts',
        code: `{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [{
          "type": "command",
          "command": "prettier --write \\"$TOOL_INPUT_FILE_PATH\\"",
          "timeout": 30
        }]
      }
    ],
    "UserPromptSubmit": [
      {
        "hooks": [{
          "type": "command",
          "command": "$CLAUDE_PROJECT_DIR/.claude/hooks/validate-prompt.sh"
        }]
      }
    ],
    "SessionStart": [
      {
        "hooks": [{
          "type": "command",
          "command": "echo \\"Session: $(date)\\" >> ~/.claude/sessions.log"
        }]
      }
    ]
  }
}`,
      },
      {
        filename: '.claude/hooks/validate-prompt.sh',
        label: 'Example: Prompt validator script',
        code: `#!/bin/bash
# Receives hook input via stdin as JSON
INPUT=$(cat)
PROMPT=$(echo "$INPUT" | jq -r '.prompt')

# Block prompts that contain raw secrets
if echo "$PROMPT" | grep -qiE '(password|api_key|secret)\\s*[:=]\\s*\\S+'; then
  echo "Blocked: prompt appears to contain a secret" >&2
  exit 2
fi

# Add current branch as context
BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null)
echo "Current git branch: $BRANCH"
exit 0`,
      },
    ],
  },
  {
    id: 'output-style', label: 'Output\nStyle', cat: 'extensibility', r: 20,
    initiated: 'user',
    short: 'Customize how Claude formats and presents its responses.',
    desc: 'Output styles modify Claude\'s system prompt to change its communication style â€” tone, verbosity, format. Built-ins include Default, Explanatory (with teaching insights), and Learning (interactive, TODO markers). You can write custom styles too.',
    doc: 'https://code.claude.com/docs/en/output-styles',
    docLabel: 'Output styles docs',
    examples: [
      {
        filename: 'Repo structure',
        label: 'Where output styles live',
        code: `.claude/
â””â”€â”€ output-styles/
    â””â”€â”€ concise.md         â† project-level style
~/.claude/output-styles/   â† personal styles (all projects)

# Activate with:
# /output-style concise`,
      },
      {
        filename: '.claude/output-styles/concise.md',
        label: 'Example: Concise output style',
        code: `---
name: Concise
description: Ultra-brief responses â€” bullets over prose,
  no preamble, no affirmations.
keep-coding-instructions: true
---

Respond as briefly as possible at all times.
- Use bullet points instead of prose
- Never explain your reasoning unless explicitly asked
- Skip all pleasantries: no "Great!", "Sure!", "Of course!"
- For code: show the code, skip the explanation
- If you need to ask a clarifying question, ask only one`,
      },
      {
        filename: '.claude/output-styles/teaching.md',
        label: 'Example: Teaching output style',
        code: `---
name: Teaching
description: Explains every decision to help juniors learn.
keep-coding-instructions: true
---

After every code change or decision:
1. Add an **Insight** block explaining *why* you made that choice
2. Reference relevant docs, patterns, or tradeoffs
3. Point out what to watch out for in the future

Format insights as:
> ğŸ’¡ **Insight**: [your explanation here]`,
      },
    ],
  },
  {
    id: 'marketplace', label: 'Marketplace', cat: 'distribution', r: 28,
    initiated: 'user',
    short: 'A catalog of plugins â€” local folder, Git repo, or hosted registry.',
    desc: 'A marketplace is a directory or Git repository with a marketplace.json listing available plugins. Register marketplaces in settings.json and install plugins from them. Great for sharing tooling across a team or org.',
    doc: 'https://code.claude.com/docs/en/plugin-marketplaces',
    docLabel: 'Plugin marketplaces docs',
    examples: [
      {
        filename: 'Repo structure (marketplace repo)',
        label: 'Marketplace repository layout',
        code: `my-org-plugins/           â† a separate git repo
â”œâ”€â”€ marketplace.json      â† registry manifest
â”œâ”€â”€ code-reviewer/        â† plugin directory
â”‚   â”œâ”€â”€ .claude-plugin/plugin.json
â”‚   â”œâ”€â”€ agents/reviewer.md
â”‚   â””â”€â”€ hooks/hooks.json
â””â”€â”€ deploy-helper/
    â”œâ”€â”€ .claude-plugin/plugin.json
    â””â”€â”€ commands/deploy.md`,
      },
      {
        filename: 'marketplace.json',
        label: 'Marketplace manifest',
        code: `{
  "name": "my-org-plugins",
  "owner": { "name": "My Org" },
  "plugins": [
    {
      "name": "code-reviewer",
      "source": "./code-reviewer",
      "description": "Automated code review tools"
    },
    {
      "name": "deploy-helper",
      "source": "./deploy-helper",
      "description": "Kubernetes deployment commands"
    }
  ]
}`,
      },
      {
        filename: '.claude/settings.json',
        label: 'Register & auto-install from a marketplace',
        code: `{
  "plugins": {
    "marketplaces": [
      "github.com/my-org/claude-plugins"
    ],
    "installed": [
      "code-reviewer@my-org",
      "deploy-helper@my-org"
    ]
  }
}`,
      },
    ],
  },
  {
    id: 'settings', label: 'Settings', cat: 'config', r: 24,
    initiated: 'user',
    short: '.claude/settings.json â€” configures hooks, plugins, permissions, and more.',
    desc: 'Settings files configure Claude Code at the user, project, or enterprise level. They control hooks, auto-installed plugins, permission modes, and other behavior. Project settings are committed to git and shared with the team.',
    doc: 'https://code.claude.com/docs/en/settings',
    docLabel: 'Settings docs',
    examples: [
      {
        filename: 'Repo structure',
        label: 'Settings file hierarchy',
        code: `~/.claude/settings.json          â† user-level (all projects)
.claude/settings.json            â† project-level (git-committed)
.claude/settings.local.json      â† local overrides (gitignored)

# Priority: local > project > user > enterprise`,
      },
      {
        filename: '.claude/settings.json',
        label: 'Example: Project settings',
        code: `{
  "plugins": {
    "marketplaces": ["github.com/my-org/claude-plugins"],
    "installed": ["code-reviewer@my-org"]
  },
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [{
          "type": "command",
          "command": "prettier --write \\"$TOOL_INPUT_FILE_PATH\\""
        }]
      }
    ]
  },
  "permissions": {
    "allow": ["Bash(npm run *)", "Bash(git *)"],
    "deny": ["Bash(rm -rf *)"]
  }
}`,
      },
      {
        filename: '.claude/rules/code-style.md',
        label: 'Example: Reusable rules file',
        code: `# Code Style Rules

## TypeScript
- Use \`type\` over \`interface\` for object shapes
- Prefer \`const\` assertions over enums
- Never use \`any\` â€” use \`unknown\` and narrow

## React
- Functional components only, no class components
- Co-locate styles with components (CSS modules)
- All event handlers named \`handleX\`

## Testing
- Test behavior, not implementation
- One \`describe\` per file, named after the module
- Use \`it\` not \`test\``,
      },
    ],
  },
  {
    id: 'mcp', label: 'MCP\nServer', cat: 'integration', r: 27,
    initiated: 'claude',
    short: 'Connects Claude to external tools, APIs, and data sources.',
    desc: 'MCP (Model Context Protocol) servers expose tools that Claude autonomously calls â€” databases, GitHub, JIRA, Sentry, file systems, and more. Servers can be local (stdio) or remote (HTTP/SSE). Config lives in .mcp.json.',
    doc: 'https://code.claude.com/docs/en/mcp',
    docLabel: 'MCP docs',
    examples: [
      {
        filename: 'Repo structure',
        label: 'Where MCP config lives',
        code: `.mcp.json                    â† project-level (git-committed)
~/.claude/mcp.json           â† user-level (all projects)
.claude/settings.local.json  â† local-only MCP overrides

# .mcp.json is the canonical project file`,
      },
      {
        filename: '.mcp.json',
        label: 'Example: GitHub + Postgres MCP servers',
        code: `{
  "mcpServers": {
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "\${GITHUB_TOKEN}"
      }
    },
    "postgres": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-postgres",
        "postgresql://localhost/mydb"
      ]
    },
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "."]
    }
  }
}`,
      },
      {
        filename: 'shell',
        label: 'Add MCP servers via CLI',
        code: `# Add a remote HTTP server
claude mcp add --transport http notion https://mcp.notion.com/mcp

# Add a local stdio server
claude mcp add --transport stdio github \\
  npx -y @modelcontextprotocol/server-github

# List configured servers
claude mcp list

# Remove a server
claude mcp remove github`,
      },
    ],
  },
];

const edges = [
  { from: 'claude-code', to: 'agent', label: 'delegates to' },
  { from: 'claude-code', to: 'plugin', label: 'extended by' },
  { from: 'claude-code', to: 'settings', label: 'configured by' },
  { from: 'claude-code', to: 'headless', label: 'run as' },
  { from: 'claude-code', to: 'mcp', label: 'calls tools via' },
  { from: 'agent', to: 'subagent', label: 'spawns' },
  { from: 'agent', to: 'skill', label: 'uses' },
  { from: 'agent', to: 'mcp', label: 'calls tools via' },
  { from: 'plugin', to: 'command', label: 'bundles' },
  { from: 'plugin', to: 'skill', label: 'bundles' },
  { from: 'plugin', to: 'hook', label: 'bundles' },
  { from: 'plugin', to: 'mcp', label: 'bundles' },
  { from: 'plugin', to: 'output-style', label: 'bundles' },
  { from: 'plugin', to: 'agent', label: 'bundles' },
  { from: 'marketplace', to: 'plugin', label: 'distributes' },
  { from: 'settings', to: 'marketplace', label: 'registers' },
  { from: 'settings', to: 'hook', label: 'defines' },
  { from: 'settings', to: 'plugin', label: 'auto-installs' },
];

// â”€â”€â”€ CANVAS SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

function resize() {
  const wrap = document.getElementById('canvas-wrap');
  W = canvas.width = wrap.offsetWidth;
  H = canvas.height = wrap.offsetHeight;
}
resize();
window.addEventListener('resize', () => { resize(); placeNodes(); });

// â”€â”€â”€ INITIAL LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function placeNodes() {
  const cx = W / 2, cy = H / 2;
  const positions = {
    'claude-code':  [0,    0],
    'agent':        [-180, -80],
    'subagent':     [-300, -190],
    'headless':     [160,  -180],
    'plugin':       [200,  90],
    'command':      [340,  190],
    'skill':        [-70,  210],
    'hook':         [280,  -50],
    'output-style': [390,  60],
    'marketplace':  [70,   -240],
    'settings':     [-220, 160],
    'mcp':          [120,  280],
  };
  nodes.forEach(n => {
    if (positions[n.id]) {
      n.x = cx + positions[n.id][0];
      n.y = cy + positions[n.id][1];
    } else {
      n.x = cx + (Math.random() - 0.5) * 400;
      n.y = cy + (Math.random() - 0.5) * 400;
    }
    n.vx = 0; n.vy = 0;
  });
}
placeNodes();

// â”€â”€â”€ PHYSICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function tick() {
  nodes.forEach((a, i) => {
    nodes.forEach((b, j) => {
      if (i >= j) return;
      const dx = b.x - a.x, dy = b.y - a.y;
      const dist = Math.sqrt(dx*dx + dy*dy) || 1;
      const minD = (a.r + b.r) * 3.0;
      if (dist < minD) {
        const f = (minD - dist) / dist * 0.1;
        if (!a.dragging) { a.vx -= dx*f; a.vy -= dy*f; }
        if (!b.dragging) { b.vx += dx*f; b.vy += dy*f; }
      }
    });
  });
  edges.forEach(e => {
    const a = nodes.find(n => n.id === e.from);
    const b = nodes.find(n => n.id === e.to);
    if (!a || !b) return;
    const dx = b.x - a.x, dy = b.y - a.y;
    const dist = Math.sqrt(dx*dx + dy*dy) || 1;
    const target = (a.r + b.r) * 2.8 + 30;
    const f = (dist - target) / dist * 0.035;
    if (!a.dragging) { a.vx += dx*f; a.vy += dy*f; }
    if (!b.dragging) { b.vx -= dx*f; b.vy -= dy*f; }
  });
  nodes.forEach(n => {
    if (n.dragging) return;
    n.vx += (W/2 - n.x) * 0.0015;
    n.vy += (H/2 - n.y) * 0.0015;
    n.vx *= 0.84; n.vy *= 0.84;
    n.x += n.vx; n.y += n.vy;
    n.x = Math.max(n.r + 8, Math.min(W - n.r - 8, n.x));
    n.y = Math.max(n.r + 8, Math.min(H - n.r - 8, n.y));
  });
}

// â”€â”€â”€ DRAW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function drawArrow(x1, y1, x2, y2, r2, highlighted) {
  const dx = x2-x1, dy = y2-y1;
  const dist = Math.sqrt(dx*dx+dy*dy);
  const ux = dx/dist, uy = dy/dist;
  const ex = x2 - ux*(r2+7), ey = y2 - uy*(r2+7);
  const sx = x1 + ux*(r2*0.3), sy = y1 + uy*(r2*0.3);
  ctx.beginPath(); ctx.moveTo(sx, sy); ctx.lineTo(ex, ey); ctx.stroke();
  const angle = Math.atan2(dy, dx);
  ctx.beginPath();
  ctx.moveTo(ex, ey);
  ctx.lineTo(ex - 9*Math.cos(angle-0.38), ey - 9*Math.sin(angle-0.38));
  ctx.lineTo(ex - 9*Math.cos(angle+0.38), ey - 9*Math.sin(angle+0.38));
  ctx.closePath(); ctx.fill();
}

let hoveredNode = null, selectedNode = null;

function draw() {
  ctx.clearRect(0, 0, W, H);

  // Edges
  edges.forEach(e => {
    const a = nodes.find(n => n.id === e.from);
    const b = nodes.find(n => n.id === e.to);
    if (!a || !b) return;
    const active = selectedNode
      ? (selectedNode.id === a.id || selectedNode.id === b.id)
      : hoveredNode
        ? (hoveredNode.id === a.id || hoveredNode.id === b.id)
        : false;
    const dim = (selectedNode || hoveredNode) && !active;
    ctx.globalAlpha = dim ? 0.06 : (active ? 0.55 : 0.12);
    ctx.strokeStyle = active ? '#c9d1d9' : '#8b949e';
    ctx.fillStyle = active ? '#c9d1d9' : '#8b949e';
    ctx.lineWidth = active ? 1.5 : 1;
    drawArrow(a.x, a.y, b.x, b.y, b.r, active);
    ctx.globalAlpha = 1;
  });

  // Nodes
  nodes.forEach(n => {
    const color = COLORS[n.cat];
    const isSelected = selectedNode && selectedNode.id === n.id;
    const isHovered = !selectedNode && hoveredNode && hoveredNode.id === n.id;
    const isConnected = (selectedNode || hoveredNode)
      ? edges.some(e => {
          const ref = selectedNode || hoveredNode;
          return (e.from === ref.id && e.to === n.id) ||
                 (e.to === ref.id && e.from === n.id) ||
                 n.id === ref.id;
        })
      : false;
    const dim = (selectedNode || hoveredNode) && !isConnected;

    ctx.globalAlpha = dim ? 0.2 : 1;

    // Glow for selected/hovered
    if (isSelected || isHovered) {
      const grd = ctx.createRadialGradient(n.x, n.y, n.r*0.4, n.x, n.y, n.r*2.5);
      grd.addColorStop(0, color + '33'); grd.addColorStop(1, 'transparent');
      ctx.fillStyle = grd;
      ctx.beginPath(); ctx.arc(n.x, n.y, n.r*2.5, 0, Math.PI*2); ctx.fill();
    }

    // Circle fill
    ctx.beginPath(); ctx.arc(n.x, n.y, n.r, 0, Math.PI*2);
    ctx.fillStyle = isSelected ? color + 'ee' : (isHovered ? color + 'cc' : color + '1e');
    ctx.fill();

    // Ring
    ctx.strokeStyle = color + (isSelected ? 'ff' : isHovered ? 'ee' : 'aa');
    ctx.lineWidth = isSelected ? 3 : isHovered ? 2.5 : 1.5;
    ctx.beginPath(); ctx.arc(n.x, n.y, n.r, 0, Math.PI*2); ctx.stroke();

    // Label
    const lines = n.label.split('\n');
    const fs = Math.max(9.5, n.r * 0.36);
    ctx.font = `${isSelected || isHovered ? 600 : 400} ${fs}px -apple-system, sans-serif`;
    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillStyle = isSelected ? '#000' : (dim ? '#484f58' : '#e6edf3');
    const lh = fs * 1.3;
    lines.forEach((line, i) => {
      ctx.fillText(line, n.x, n.y + (i - (lines.length-1)/2) * lh);
    });
    ctx.globalAlpha = 1;
  });
}

function loop() { tick(); draw(); requestAnimationFrame(loop); }
loop();

// â”€â”€â”€ SIDE PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const panel = document.getElementById('side-panel');
const panelTitle = document.getElementById('panel-title');
const panelBadges = document.getElementById('panel-badges');
const panelDesc = document.getElementById('panel-desc');
const panelDoclink = document.getElementById('panel-doclink');
const panelExamples = document.getElementById('panel-examples');
const panelRelated = document.getElementById('panel-related');

const INITIATED_CONFIG = {
  user:   { label: 'ğŸ‘¤ User-initiated', cls: 'badge-user',   tip: 'You explicitly trigger this' },
  claude: { label: 'ğŸ¤– Claude-initiated', cls: 'badge-claude', tip: 'Claude autonomously decides when to use this' },
  both:   { label: 'â†” User or Claude', cls: 'badge-both',   tip: 'Can be triggered either way' },
  system: { label: 'âš™ System-triggered', cls: 'badge-system', tip: 'Fires automatically on lifecycle events' },
};

function openPanel(node) {
  selectedNode = node;
  panelTitle.textContent = node.label.replace('\n', ' ');

  // Badges
  panelBadges.innerHTML = '';
  const ic = INITIATED_CONFIG[node.initiated];
  const b1 = document.createElement('span');
  b1.className = `badge ${ic.cls}`;
  b1.title = ic.tip;
  b1.textContent = ic.label;
  panelBadges.appendChild(b1);

  const b2 = document.createElement('span');
  b2.className = 'badge badge-cat';
  const catColor = COLORS[node.cat];
  b2.style.borderColor = catColor + '66';
  b2.style.color = catColor;
  b2.style.background = catColor + '11';
  b2.textContent = CAT_LABELS[node.cat];
  panelBadges.appendChild(b2);

  // Description
  panelDesc.textContent = node.desc;

  // Doc link
  panelDoclink.innerHTML = node.doc ? `
    <a href="${node.doc}" target="_blank" rel="noopener">
      <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
        <path d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"/>
      </svg>
      ${node.docLabel || 'Official documentation'}
    </a>` : '';

  // Code examples
  panelExamples.innerHTML = '';
  (node.examples || []).forEach((ex, idx) => {
    const wrap = document.createElement('div');
    wrap.className = 'code-toggle';
    const header = document.createElement('div');
    header.className = 'code-toggle-header';
    header.innerHTML = `
      <span class="code-toggle-label">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="#8b949e">
          <path d="M8.878.392a1.75 1.75 0 00-1.756 0l-5.25 3.045A1.75 1.75 0 001 4.951v6.098c0 .624.332 1.2.872 1.514l5.25 3.045a1.75 1.75 0 001.756 0l5.25-3.045c.54-.313.872-.89.872-1.514V4.951c0-.624-.332-1.2-.872-1.514L8.878.392z"/>
        </svg>
        <span class="filename">${ex.filename}</span>
        <span style="color:#484f58">Â·</span>
        ${ex.label}
      </span>
      <span class="code-toggle-chevron ${idx === 0 ? 'open' : ''}">â–¶</span>`;
    const body = document.createElement('div');
    body.className = `code-toggle-body ${idx === 0 ? 'open' : ''}`;
    const pre = document.createElement('pre');
    pre.textContent = ex.code;
    body.appendChild(pre);
    header.addEventListener('click', () => {
      const open = body.classList.toggle('open');
      header.querySelector('.code-toggle-chevron').classList.toggle('open', open);
    });
    wrap.appendChild(header);
    wrap.appendChild(body);
    panelExamples.appendChild(wrap);
  });

  // Related nodes
  const related = new Set();
  edges.forEach(e => {
    if (e.from === node.id) related.add(e.to);
    if (e.to === node.id) related.add(e.from);
  });
  if (related.size > 0) {
    panelRelated.innerHTML = '<h4>Related concepts</h4><div class="related-chips"></div>';
    const chips = panelRelated.querySelector('.related-chips');
    related.forEach(id => {
      const rel = nodes.find(n => n.id === id);
      if (!rel) return;
      const chip = document.createElement('span');
      chip.className = 'related-chip';
      chip.textContent = rel.label.replace('\n', ' ');
      chip.addEventListener('click', () => openPanel(rel));
      chips.appendChild(chip);
    });
  } else {
    panelRelated.innerHTML = '';
  }

  panel.classList.add('open');
}

document.getElementById('panel-close').addEventListener('click', () => {
  panel.classList.remove('open');
  selectedNode = null;
});

// â”€â”€â”€ INTERACTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const tooltip = document.getElementById('tooltip');
const ttTitle = document.getElementById('tt-title');
const ttDesc = document.getElementById('tt-desc');

let dragging = null, dragOffX = 0, dragOffY = 0, mouseDownNode = null;
let mouseDownTime = 0;

function getNode(mx, my) {
  return nodes.find(n => Math.hypot(n.x - mx, n.y - my) < n.r) || null;
}

canvas.addEventListener('mousemove', e => {
  const mx = e.clientX, my = e.clientY - 44;
  if (dragging) {
    dragging.x = mx + dragOffX;
    dragging.y = my + dragOffY;
    return;
  }
  hoveredNode = getNode(mx, my);
  if (hoveredNode && hoveredNode !== selectedNode) {
    canvas.style.cursor = 'pointer';
    ttTitle.textContent = hoveredNode.label.replace('\n', ' ');
    ttDesc.textContent = hoveredNode.short;
    tooltip.style.opacity = 1;
    let tx = e.clientX + 16, ty = e.clientY - 10;
    if (tx + 240 > window.innerWidth) tx = e.clientX - 236;
    if (ty + 90 > window.innerHeight) ty = e.clientY - 90;
    tooltip.style.left = tx + 'px';
    tooltip.style.top = ty + 'px';
  } else {
    canvas.style.cursor = 'default';
    tooltip.style.opacity = 0;
  }
});

canvas.addEventListener('mousedown', e => {
  const mx = e.clientX, my = e.clientY - 44;
  mouseDownNode = getNode(mx, my);
  mouseDownTime = Date.now();
  if (mouseDownNode) {
    dragOffX = mouseDownNode.x - mx;
    dragOffY = mouseDownNode.y - my;
    dragging = mouseDownNode;
    dragging.dragging = true;
    canvas.style.cursor = 'grabbing';
  }
});

canvas.addEventListener('mouseup', e => {
  const elapsed = Date.now() - mouseDownTime;
  const mx = e.clientX, my = e.clientY - 44;
  const upNode = getNode(mx, my);

  if (dragging) {
    dragging.dragging = false;
    dragging.vx = 0; dragging.vy = 0;
    dragging = null;
  }

  // Click = short press on same node
  if (elapsed < 250 && upNode && upNode === mouseDownNode) {
    tooltip.style.opacity = 0;
    openPanel(upNode);
  }
  canvas.style.cursor = 'default';
  mouseDownNode = null;
});

canvas.addEventListener('mouseleave', () => {
  tooltip.style.opacity = 0;
  if (dragging) { dragging.dragging = false; dragging = null; }
  hoveredNode = null;
});

// Click on canvas background â†’ close panel
canvas.addEventListener('click', e => {
  const mx = e.clientX, my = e.clientY - 44;
  if (!getNode(mx, my) && selectedNode) {
    panel.classList.remove('open');
    selectedNode = null;
  }
});
</script>
</body>
</html>
