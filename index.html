<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claude Graph</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;0,700;1,500&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:       #090c12;
  --surf:     #0e1220;
  --surf2:    #131826;
  --border:   #1b2235;
  --border2:  #242e45;
  --text:     #ddd6c3;
  --dim:      #7d7566;
  --muted:    #424955;
  --accent:   #d4a853;
  --accent-b: rgba(212,168,83,.14);
  --accent-r: rgba(212,168,83,.3);
}

/* ── LIGHT THEME ─────────────────────────────────────────────── */
:root[data-theme="light"] {
  --bg:       #f5f1e8;
  --surf:     #fdfaf3;
  --surf2:    #f0ece1;
  --border:   #ddd5c2;
  --border2:  #c9c0ab;
  --text:     #1c170e;
  --dim:      #5c5346;
  --muted:    #9c9080;
  --accent:   #a67218;
  --accent-b: rgba(166,114,24,.12);
  --accent-r: rgba(166,114,24,.32);
}
@media (prefers-color-scheme: light) {
  :root[data-theme="system"] {
    --bg:       #f5f1e8;
    --surf:     #fdfaf3;
    --surf2:    #f0ece1;
    --border:   #ddd5c2;
    --border2:  #c9c0ab;
    --text:     #1c170e;
    --dim:      #5c5346;
    --muted:    #9c9080;
    --accent:   #a67218;
    --accent-b: rgba(166,114,24,.12);
    --accent-r: rgba(166,114,24,.32);
  }
}

html, body {
  width: 100%; height: 100%; overflow: hidden;
  background: var(--bg);
  color: var(--text);
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
}

/* ── TOP BAR ─────────────────────────────────────────────────── */
#topbar {
  position: fixed; top: 0; left: 0; right: 0; height: 48px;
  background: color-mix(in srgb, var(--bg) 88%, transparent);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; padding: 0 24px; gap: 16px;
  z-index: 30; backdrop-filter: blur(12px);
}
#topbar-logo {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px; font-weight: 500;
  color: var(--accent); letter-spacing: .1em; text-transform: uppercase;
}
#topbar-sep { color: var(--border2); font-size: 20px; font-weight: 200; }
#topbar-sub {
  font-size: 10px; letter-spacing: .12em; text-transform: uppercase;
  color: var(--dim);
}
#topbar-hint {
  font-size: 10px; color: var(--muted); letter-spacing: .05em;
}

/* ── THEME TOGGLE ─────────────────────────────────────────────── */
.theme-toggle {
  margin-left: auto;
  display: flex; gap: 2px;
  background: var(--surf2); border: 1px solid var(--border);
  border-radius: 6px; padding: 3px;
}
.theme-btn {
  background: none; border: none; cursor: pointer;
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; letter-spacing: .08em; text-transform: uppercase;
  color: var(--muted); padding: 3px 9px; border-radius: 4px;
  transition: background .15s, color .15s;
}
.theme-btn:hover { color: var(--dim); }
.theme-btn.active { background: var(--accent-b); color: var(--accent); }

/* ── CANVAS ───────────────────────────────────────────────────── */
#canvas-wrap {
  position: fixed; inset: 48px 0 0 0; z-index: 1;
}
canvas { display: block; width: 100%; height: 100%; cursor: default; }

/* ── TOOLTIP ──────────────────────────────────────────────────── */
#tooltip {
  position: fixed; z-index: 40; pointer-events: none;
  background: var(--surf2);
  border: 1px solid var(--border2);
  border-radius: 8px; padding: 11px 15px;
  max-width: 230px; opacity: 0;
  transition: opacity .12s ease;
  box-shadow: 0 8px 32px rgba(0,0,0,.55);
}
#tooltip h3 {
  font-family: 'Playfair Display', serif; font-size: 14px; font-weight: 700;
  color: var(--accent); margin-bottom: 5px; letter-spacing: -.1px;
}
#tooltip p { font-size: 11px; color: var(--dim); line-height: 1.5; }
#tooltip .tt-cat {
  font-size: 9px; text-transform: uppercase; letter-spacing: .1em;
  margin-top: 7px; color: var(--muted);
}

/* ── SIDE PANEL ───────────────────────────────────────────────── */
#panel {
  position: fixed; top: 48px; right: 0; bottom: 0;
  width: 440px; min-width: 300px; max-width: 80vw;
  z-index: 20;
  background: var(--surf);
  border-left: 1px solid var(--border);
  display: flex; flex-direction: column;
  transform: translateX(100%);
  transition: transform .36s cubic-bezier(.4,0,.2,1);
  box-shadow: -20px 0 60px rgba(0,0,0,.4);
}
#panel.open { transform: translateX(0); }
#panel.resizing { transition: none; user-select: none; }

/* Resize handle */
#panel-resize {
  position: absolute; left: 0; top: 0; bottom: 0; width: 5px;
  cursor: ew-resize; z-index: 1;
}
#panel-resize::after {
  content: '';
  position: absolute; left: 2px; top: 50%; transform: translateY(-50%);
  width: 1px; height: 40px;
  background: var(--border2);
  border-radius: 1px;
  transition: background .15s, height .15s;
}
#panel-resize:hover::after { background: var(--accent-r); height: 56px; }
body.panel-resizing { cursor: ew-resize; user-select: none; }

/* Panel header */
.p-head {
  padding: 24px 24px 18px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0; position: relative;
}
.p-cat {
  font-size: 9px; text-transform: uppercase; letter-spacing: .14em;
  margin-bottom: 8px;
}
.p-title {
  font-family: 'Playfair Display', serif;
  font-size: 24px; font-weight: 700;
  color: var(--text); line-height: 1.2;
  margin-bottom: 10px;
}
#p-badges { display: flex; gap: 7px; flex-wrap: wrap; }

.badge {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 3px 9px; border-radius: 20px;
  font-size: 10px; letter-spacing: .03em; border: 1px solid;
}
.badge-user   { background: #0c1e30; border-color: #1e5a8a; color: #5aaaf0; }
.badge-claude { background: #16142a; border-color: #5040a0; color: #c0a8f8; }
.badge-both   { background: #0e1e12; border-color: #2a7040; color: #55d46a; }
.badge-system { background: #151a15; border-color: #35453a; color: #70a07a; }
.badge-cat    {
  padding: 3px 9px; border-radius: 20px; font-size: 10px;
  letter-spacing: .03em; border: 1px solid;
}

#p-close {
  position: absolute; top: 20px; right: 20px;
  background: none; border: 1px solid var(--border2);
  border-radius: 5px; color: var(--dim); cursor: pointer;
  width: 26px; height: 26px; display: flex; align-items: center;
  justify-content: center; font-size: 14px; line-height: 1;
  transition: border-color .15s, color .15s, background .15s;
  font-family: inherit;
}
#p-close:hover { border-color: var(--accent-r); color: var(--accent); background: var(--accent-b); }

/* Panel scroll body */
.p-body {
  flex: 1; overflow-y: auto; padding: 20px 24px 36px;
  scrollbar-width: thin; scrollbar-color: var(--border2) transparent;
}
.p-body::-webkit-scrollbar { width: 4px; }
.p-body::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

.p-desc {
  font-size: 13px; line-height: 1.8; color: #b0a898;
  margin-bottom: 20px; font-family: 'JetBrains Mono', monospace;
  font-weight: 300;
}

.p-doc-link {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 8px 14px; border-radius: 6px; margin-bottom: 22px;
  background: var(--accent-b); border: 1px solid var(--accent-r);
  color: var(--accent); font-size: 11px; text-decoration: none;
  letter-spacing: .04em; transition: background .15s, border-color .15s;
}
.p-doc-link:hover { background: rgba(212,168,83,.22); border-color: rgba(212,168,83,.5); }
.p-doc-link svg { flex-shrink: 0; opacity: .7; }

/* Code accordion */
.code-block {
  border: 1px solid var(--border); border-radius: 8px;
  overflow: hidden; margin-bottom: 10px;
}
.cb-head {
  display: flex; align-items: center; justify-content: space-between;
  padding: 9px 13px; background: var(--surf2); cursor: pointer;
  user-select: none; gap: 10px;
}
.cb-head:hover { background: #181f30; }
.cb-label {
  display: flex; align-items: center; gap: 8px;
  font-size: 11px; color: var(--dim); min-width: 0; overflow: hidden;
}
.cb-filename {
  color: var(--text); font-weight: 500; font-size: 10.5px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.cb-sublabel {
  color: var(--muted); font-size: 10px; white-space: nowrap;
  overflow: hidden; text-overflow: ellipsis; flex-shrink: 1;
}
.cb-chevron {
  font-size: 9px; color: var(--muted); flex-shrink: 0;
  transition: transform .22s; line-height: 1;
}
.cb-chevron.open { transform: rotate(90deg); }
.cb-body {
  max-height: 0; overflow: hidden;
  transition: max-height .28s cubic-bezier(.4,0,.2,1);
}
.cb-body.open { max-height: 700px; }
.cb-body pre {
  margin: 0 !important; border-radius: 0 !important; border: none !important;
  font-size: 11.5px !important; line-height: 1.65 !important;
  font-family: 'JetBrains Mono', 'Fira Code', monospace !important;
}
.cb-body pre::-webkit-scrollbar { height: 4px; }
.cb-body pre::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

/* Related chips */
.p-related-title {
  font-size: 9px; text-transform: uppercase; letter-spacing: .12em;
  color: var(--muted); margin: 22px 0 10px;
}
.chips { display: flex; flex-wrap: wrap; gap: 6px; }
.chip {
  padding: 4px 11px; border-radius: 6px; font-size: 10.5px;
  border: 1px solid var(--border); color: var(--dim); cursor: pointer;
  background: var(--surf2); letter-spacing: .02em;
  transition: border-color .15s, color .15s, background .15s;
}
.chip:hover { border-color: var(--accent-r); color: var(--accent); background: var(--accent-b); }

/* ── NAV BACK BUTTON ─────────────────────────────────────────── */
#nav-back {
  display: none;
  position: fixed; bottom: 20px; left: 20px; z-index: 15;
  background: var(--surf2); border: 1px solid var(--border2);
  border-radius: 6px; color: var(--dim); cursor: pointer;
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px; font-weight: 500; letter-spacing: .06em;
  padding: 7px 16px;
  transition: color .15s, border-color .15s, background .15s;
}
#nav-back:hover {
  color: var(--accent); border-color: var(--accent-r); background: var(--accent-b);
}

/* ── LEGEND ───────────────────────────────────────────────────── */
#legend {
  position: fixed; top: 68px; left: 20px; z-index: 10;
  background: color-mix(in srgb, var(--bg) 90%, transparent);
  border: 1px solid var(--border);
  border-radius: 10px; padding: 13px 16px;
  backdrop-filter: blur(10px);
}
.leg-title {
  font-size: 8px; text-transform: uppercase; letter-spacing: .15em;
  color: var(--muted); margin-bottom: 10px;
}
.leg-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.leg-item:last-child { margin-bottom: 0; }
.leg-dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }
.leg-label { font-size: 10px; color: var(--dim); }

/* ── PRIMACY/RECENCY PULSE ────────────────────────────────────── */
@keyframes pb-ring {
  0%   { r: 6;  opacity: .55; }
  60%  { r: 13; opacity: 0;   }
  100% { r: 13; opacity: 0;   }
}
.pb-ring { animation: pb-ring 2.4s ease-out infinite; }
.pb-ring-delay { animation: pb-ring 2.4s ease-out infinite; animation-delay: 1.2s; }

/* ── HLJS overrides ───────────────────────────────────────────── */
.hljs { background: #0d1117 !important; padding: 14px 16px !important; }

/* ── LOOP DIAGRAM ─────────────────────────────────────────────── */
.loop-svg-wrap {
  background: var(--surf); border: 1px solid var(--border);
  border-radius: 10px; padding: 28px 20px 20px;
  margin-bottom: 28px; overflow: hidden;
}
.loop-svg { width: 100%; height: auto; display: block; }
.loop-svg text { font-family: 'JetBrains Mono', monospace; }

/* ── LINK CARDS ───────────────────────────────────────────────── */
.ref-links-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
  gap: 10px;
}
.ref-link-card {
  display: block; padding: 14px 16px;
  background: var(--surf2); border: 1px solid var(--border);
  border-radius: 8px; text-decoration: none;
  transition: border-color .15s, background .15s;
}
.ref-link-card:hover { border-color: var(--accent-r); background: var(--accent-b); }
.rlc-title { font-size: 12px; font-weight: 500; color: var(--accent); margin-bottom: 4px; letter-spacing: .02em; }
.rlc-desc  { font-size: 11px; color: var(--dim); line-height: 1.5; font-weight: 300; }

/* ── TABS ─────────────────────────────────────────────────────── */
.tab-group {
  display: flex; gap: 4px; margin-left: 20px;
}
.tab-btn {
  background: none; border: 1px solid var(--border);
  border-radius: 5px; padding: 4px 12px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px; letter-spacing: .06em; text-transform: uppercase;
  color: var(--muted); cursor: pointer;
  transition: border-color .15s, color .15s, background .15s;
}
.tab-btn:hover { border-color: var(--border2); color: var(--dim); }
.tab-btn.active {
  border-color: var(--accent-r); color: var(--accent);
  background: var(--accent-b);
}

/* ── REFERENCE PANEL ──────────────────────────────────────────── */
#ref-panel {
  display: none;
  position: fixed; inset: 48px 0 0 0; z-index: 1;
  overflow-y: auto; padding: 52px 24px 72px;
  scrollbar-width: thin; scrollbar-color: var(--border2) transparent;
}
#ref-panel::-webkit-scrollbar { width: 5px; }
#ref-panel::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
#ref-panel.active { display: block; }

.ref-container { max-width: 820px; margin: 0 auto; }

.ref-section { margin-bottom: 64px; }

.ref-section-label {
  font-size: 9px; text-transform: uppercase; letter-spacing: .16em;
  color: var(--muted); margin-bottom: 10px;
}
.ref-section h2 {
  font-family: 'Playfair Display', serif;
  font-size: 26px; font-weight: 700;
  color: var(--text); line-height: 1.2; margin-bottom: 14px;
}
.ref-section .ref-lead {
  font-size: 14px; line-height: 1.8; color: var(--dim);
  font-weight: 300; max-width: 640px; margin-bottom: 32px;
}

.ref-divider {
  border: none; border-top: 1px solid var(--border);
  margin-bottom: 32px;
}

/* Image card */
.ref-img-card {
  border: 1px solid var(--border); border-radius: 10px;
  overflow: hidden; margin-bottom: 28px;
  background: var(--surf);
}
.ref-img-card-header {
  padding: 10px 14px; background: var(--surf2);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 8px;
}
.ref-img-card-header span {
  font-size: 10px; color: var(--dim); letter-spacing: .03em;
}
.ref-img-card-header .ref-img-filename {
  color: var(--text); font-weight: 500; font-size: 10.5px;
}
.ref-img-card img {
  display: block; width: 100%; height: auto;
  opacity: .92;
}

/* Inline code block for reference */
.ref-code-block {
  border: 1px solid var(--border); border-radius: 8px;
  overflow: hidden; margin-bottom: 28px;
}
.ref-code-block-header {
  padding: 10px 14px; background: var(--surf2);
  border-bottom: 1px solid var(--border);
  font-size: 10.5px; color: var(--text); font-weight: 500;
  letter-spacing: .02em;
  display: flex; align-items: center; justify-content: space-between;
}

/* ── COPY BUTTON ──────────────────────────────────────────────── */
.copy-btn {
  background: none; border: 1px solid transparent;
  cursor: pointer; border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; letter-spacing: .08em; text-transform: uppercase;
  color: var(--muted); padding: 2px 7px; flex-shrink: 0;
  transition: color .15s, border-color .15s, background .15s;
  line-height: 1.6;
}
.copy-btn:hover { color: var(--dim); border-color: var(--border2); background: var(--surf); }
.copy-btn.copied { color: #5ea878; border-color: #5ea87845; background: #5ea87810; }
.ref-code-block pre {
  margin: 0 !important; border-radius: 0 !important; border: none !important;
  font-size: 12px !important; line-height: 1.7 !important;
  font-family: 'JetBrains Mono', monospace !important;
}

/* ── CREDITS ──────────────────────────────────────────────────── */
.ref-credits {
  border-top: 1px solid var(--border);
  padding-top: 32px;
  margin-top: 16px;
}
.ref-credits-label {
  font-size: 9px; text-transform: uppercase; letter-spacing: .16em;
  color: var(--muted); margin-bottom: 14px;
}
.ref-credits-row {
  display: flex; align-items: flex-start; gap: 14px;
  padding: 16px; border-radius: 8px;
  background: var(--surf2); border: 1px solid var(--border);
  margin-bottom: 10px;
}
.ref-credits-icon {
  font-size: 20px; flex-shrink: 0; line-height: 1;
  margin-top: 2px; opacity: .8;
}
.ref-credits-body { min-width: 0; }
.ref-credits-name {
  font-size: 12px; font-weight: 500; color: var(--text);
  margin-bottom: 3px; letter-spacing: .02em;
}
.ref-credits-name a {
  color: var(--accent); text-decoration: none;
  border-bottom: 1px solid var(--accent-r);
  transition: border-color .15s;
}
.ref-credits-name a:hover { border-color: var(--accent); }
.ref-credits-desc {
  font-size: 11px; color: var(--dim); line-height: 1.5; font-weight: 300;
}

/* Key points list */
.ref-points { list-style: none; margin-bottom: 0; }
.ref-points li {
  display: flex; gap: 12px; align-items: baseline;
  font-size: 13px; line-height: 1.7; color: var(--dim);
  font-weight: 300; margin-bottom: 10px; padding-bottom: 10px;
  border-bottom: 1px solid var(--border);
}
.ref-points li:last-child { border-bottom: none; margin-bottom: 0; }
.ref-points li .rp-marker {
  color: var(--accent); font-size: 10px; letter-spacing: .08em;
  text-transform: uppercase; flex-shrink: 0; padding-top: 3px;
  min-width: 64px;
}
.ref-points li strong { color: var(--text); font-weight: 500; }
</style>
</head>
<body>

<div id="topbar">
  <span id="topbar-logo">Claude Graph</span>
  <span id="topbar-sep">·</span>
  <div class="tab-group">
    <button class="tab-btn active" data-tab="graph">Concept Map</button>
    <button class="tab-btn" data-tab="ref">Reference</button>
  </div>
  <span id="topbar-hint">hover to preview · click to explore</span>
  <div class="theme-toggle">
    <button class="theme-btn" data-mode="light">Light</button>
    <button class="theme-btn active" data-mode="dark">Dark</button>
    <button class="theme-btn" data-mode="system">System</button>
  </div>
</div>

<div id="canvas-wrap"><canvas id="c"></canvas></div>

<div id="ref-panel">
  <div class="ref-container">

    <!-- ── GETTING STARTED ──────────────────────────────────── -->
    <div class="ref-section">
      <div class="ref-section-label">Getting Started</div>
      <h2>Installation</h2>

      <hr class="ref-divider">

      <div class="ref-code-block">
        <div class="ref-code-block-header">macOS</div>
        <pre><code class="language-bash">curl -fsSL https://claude.ai/install.sh | bash</code></pre>
      </div>

      <div class="ref-links-grid">
        <a href="https://docs.anthropic.com/en/docs/claude-code/overview" target="_blank" rel="noopener" class="ref-link-card">
          <div class="rlc-title">Overview ↗</div>
          <div class="rlc-desc">What Claude Code is and how it works</div>
        </a>
        <a href="https://docs.anthropic.com/en/docs/claude-code/getting-started" target="_blank" rel="noopener" class="ref-link-card">
          <div class="rlc-title">Getting Started ↗</div>
          <div class="rlc-desc">Install, configure, run your first session</div>
        </a>
        <a href="https://docs.anthropic.com/en/docs/claude-code/cli-reference" target="_blank" rel="noopener" class="ref-link-card">
          <div class="rlc-title">CLI Reference ↗</div>
          <div class="rlc-desc">All flags, commands, and options</div>
        </a>
        <a href="https://docs.anthropic.com/en/docs/claude-code/settings" target="_blank" rel="noopener" class="ref-link-card">
          <div class="rlc-title">Settings ↗</div>
          <div class="rlc-desc">Full configuration reference</div>
        </a>
        <a href="https://docs.anthropic.com/en/docs/claude-code/hooks" target="_blank" rel="noopener" class="ref-link-card">
          <div class="rlc-title">Hooks ↗</div>
          <div class="rlc-desc">Lifecycle event automation</div>
        </a>
        <a href="https://docs.anthropic.com/en/docs/claude-code/sub-agents" target="_blank" rel="noopener" class="ref-link-card">
          <div class="rlc-title">Agents ↗</div>
          <div class="rlc-desc">Subagents and parallel tasks</div>
        </a>
      </div>
    </div>

    <!-- ── CLI REFERENCE ────────────────────────────────────── -->
    <div class="ref-section">
      <div class="ref-section-label">Getting Started</div>
      <h2>The <code style="font-family:inherit;font-size:inherit;background:var(--surf2);padding:2px 8px;border-radius:4px;border:1px solid var(--border)">claude</code> CLI</h2>
      <p class="ref-lead">Everything in Claude Code flows through the <code>claude</code> command. Start an interactive session, run one-shot prompts in scripts, manage MCP servers, or control behavior with flags.</p>

      <hr class="ref-divider">

      <div class="ref-code-block">
        <div class="ref-code-block-header">CLI flags</div>
        <pre><code class="language-bash">claude                             # start interactive session
claude -p "Fix the auth bug"       # headless: one-shot prompt
claude --model claude-opus-4-6     # override model for this session
claude --output-format json        # json | text | stream-json
claude --allowedTools Bash,Read    # restrict tools for this run
claude --max-turns 10              # cap the agentic loop iterations
claude --verbose                   # show full tool call details

# MCP subcommands
claude mcp add --transport stdio github \
  npx -y @modelcontextprotocol/server-github
claude mcp list
claude mcp remove github</code></pre>
      </div>

      <div class="ref-code-block">
        <div class="ref-code-block-header">In-session slash commands</div>
        <pre><code class="language-plaintext">/help           Show all available commands
/compact        Summarize conversation history (saves tokens)
/cost           Show token usage and estimated spend so far
/model          Switch model mid-session
/clear          Clear conversation and start fresh
/plan           Enter plan mode — propose before building
/init           Generate CLAUDE.md from your codebase
/output-style   Switch output style for this session
/memory         View or edit your CLAUDE.md files
/review         Run code review (if defined as a command)
/quit           Exit Claude Code</code></pre>
      </div>

      <ul class="ref-points">
        <li>
          <span class="rp-marker"><code>/compact</code></span>
          <span>Run this when the context window is filling up. Summarizes the conversation in place — Claude keeps working with the key facts at a fraction of the token cost.</span>
        </li>
        <li>
          <span class="rp-marker"><code>/plan</code></span>
          <span>Asks Claude to enter plan mode: propose a full approach before writing any code. You approve or redirect, then implementation begins. Prevents expensive wrong-direction work.</span>
        </li>
        <li>
          <span class="rp-marker"><code>/cost</code></span>
          <span>Shows token usage and estimated API spend for the current session. Useful for keeping large agentic workflows within budget.</span>
        </li>
        <li>
          <span class="rp-marker"><code>/init</code></span>
          <span>Analyzes your project and writes a starter <code>CLAUDE.md</code>. Run once when setting up a new project — then customize the output. Understand the primacy/recency bias before editing.</span>
        </li>
      </ul>
    </div>

    <!-- ── TOKENS ───────────────────────────────────────────── -->
    <div class="ref-section">
      <div class="ref-section-label">Foundations</div>
      <h2>Tokens</h2>
      <p class="ref-lead">Tokens are the basic unit of text that language models process. They're not exactly words — the tokenizer splits text at sub-word boundaries, grouping common sequences together. Cost and context limits are both measured in tokens, so having a rough sense of scale matters.</p>

      <hr class="ref-divider">

      <div class="ref-code-block">
        <div class="ref-code-block-header">Rough token scale</div>
        <pre><code class="language-plaintext">Rule of thumb: ~4 characters ≈ 1 token, ~750 words ≈ 1,000 tokens

"Hello, world!"                          →    ~4 tokens
A short function (10 lines)              →   ~60 tokens
A medium file (100 lines)                →  ~600 tokens
A large file (1,000 lines)               → ~6,000 tokens
GPT-4-length novel (100k words)          → ~130,000 tokens

# Estimate any file's token count:
wc -c myfile.ts | awk '{printf "~%d tokens\n", $1/4}'</code></pre>
      </div>

      <ul class="ref-points">
        <li>
          <span class="rp-marker">Input</span>
          <span>Everything Claude <em>reads</em> in a session — your message, file contents, tool results, CLAUDE.md — counts as input tokens.</span>
        </li>
        <li>
          <span class="rp-marker">Output</span>
          <span>Everything Claude <em>writes</em> — its replies, code edits, tool call arguments — counts as output tokens. Output costs more per token than input.</span>
        </li>
        <li>
          <span class="rp-marker">Code vs prose</span>
          <span>Code is often more token-dense than prose because of symbols, indentation, and repeated keywords. A 100-line TypeScript file can easily be 800–1,500 tokens.</span>
        </li>
      </ul>
    </div>

    <!-- ── CONTEXT WINDOW ────────────────────────────────────── -->
    <div class="ref-section">
      <div class="ref-section-label">Foundations</div>
      <h2>Context Window</h2>
      <p class="ref-lead">The context window is Claude's working memory — the total number of tokens it can see at once. Everything in a session shares this space: your conversation, loaded files, tool results, CLAUDE.md, and the system prompt. When it fills up, something has to give.</p>

      <hr class="ref-divider">

      <div class="ref-code-block">
        <div class="ref-code-block-header">What lives in the context window</div>
        <pre><code class="language-plaintext">┌─────────────────────────────────────────────────────┐
│  Context Window  (~200,000 tokens for Sonnet/Opus)  │
│                                                     │
│  System prompt          ~500–2,000 tokens           │
│  CLAUDE.md (loaded fresh each session)   ~variable  │
│  Conversation history   grows over time             │
│  File contents          (each Read adds tokens)     │
│  Tool call results      (Bash output, search hits)  │
│                                                     │
└─────────────────────────────────────────────────────┘

When full → older turns are dropped automatically
Use /compact to summarize history and reclaim space</code></pre>
      </div>

      <ul class="ref-points">
        <li>
          <span class="rp-marker"><code>/compact</code></span>
          <span>Summarizes the conversation history in place, dramatically reducing token usage while preserving the key facts Claude needs to continue working.</span>
        </li>
        <li>
          <span class="rp-marker">CLAUDE.md</span>
          <span>Loaded fresh at the start of every session, not carried over from previous ones — so it doesn't silently consume context across sessions.</span>
        </li>
        <li>
          <span class="rp-marker">Subagents</span>
          <span>Each subagent (spawned via the Task tool) gets its own isolated context window. This is one of the main reasons to use them — they don't share the parent's growing context.</span>
        </li>
        <li>
          <span class="rp-marker">Big codebases</span>
          <span>Reading many large files in one session fills the window fast. Prefer targeted reads (specific functions, not whole files) and use Grep/Glob to find exactly what you need.</span>
        </li>
      </ul>
    </div>

    <!-- ── AGENTIC LOOP ──────────────────────────────────────── -->
    <div class="ref-section">
      <div class="ref-section-label">Foundations</div>
      <h2>The Agentic Loop</h2>
      <p class="ref-lead">Claude Code doesn't respond in a single shot. It runs in a loop — thinking, calling a tool, reading the result, thinking again — until it decides the task is done. This is what makes it capable of multi-step work, and it's the foundation everything else is built on.</p>

      <hr class="ref-divider">

      <div class="loop-svg-wrap">
        <svg id="loop-diagram" class="loop-svg" viewBox="0 0 620 190" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <marker id="arr" viewBox="0 0 8 8" refX="7" refY="4" markerWidth="5" markerHeight="5" orient="auto">
              <path d="M0,0 L8,4 L0,8 Z" fill="#424955"/>
            </marker>
            <marker id="arr-accent" viewBox="0 0 8 8" refX="7" refY="4" markerWidth="5" markerHeight="5" orient="auto">
              <path d="M0,0 L8,4 L0,8 Z" fill="#d4a853"/>
            </marker>
          </defs>

          <!-- ── Static connector lines ── -->
          <!-- You → Claude -->
          <line x1="94" y1="84" x2="143" y2="84" stroke="#2a3448" stroke-width="1.5" marker-end="url(#arr)"/>
          <!-- Claude → Tool -->
          <line x1="283" y1="84" x2="332" y2="84" stroke="#2a3448" stroke-width="1.5" marker-end="url(#arr)"/>
          <!-- Tool → Result -->
          <line x1="448" y1="84" x2="497" y2="84" stroke="#2a3448" stroke-width="1.5" marker-end="url(#arr)"/>
          <!-- Result loops back to Claude (dashed curve below) -->
          <path id="loop-path" d="M557,102 C557,155 283,155 220,102"
                stroke="#2a3448" stroke-width="1.5" fill="none"
                stroke-dasharray="5,3" marker-end="url(#arr)"/>
          <!-- "repeat" label -->
          <text x="390" y="172" text-anchor="middle" font-size="9.5" fill="#424955" letter-spacing=".06em">REPEAT UNTIL DONE</text>

          <!-- Claude "when done" exit — downward dotted -->
          <line x1="213" y1="103" x2="213" y2="138" stroke="#2a3448" stroke-width="1" stroke-dasharray="3,2"/>
          <text x="222" y="155" font-size="9.5" fill="#424955" letter-spacing=".04em">↓ response when done</text>

          <!-- ── Nodes ── -->
          <!-- You -->
          <g id="ld-you">
            <rect x="8" y="66" width="86" height="36" rx="7" fill="#0e1220" stroke="#1b2235" stroke-width="1.5"/>
            <text x="51" y="87" text-anchor="middle" font-size="11" fill="#7d7566" font-weight="400">You</text>
          </g>

          <!-- Claude thinks -->
          <g id="ld-claude">
            <rect x="145" y="66" width="138" height="36" rx="7" fill="#0e1220" stroke="#1b2235" stroke-width="1.5"/>
            <text x="214" y="87" text-anchor="middle" font-size="11" fill="#7d7566" font-weight="400">Claude thinks</text>
          </g>

          <!-- Tool call -->
          <g id="ld-tool">
            <rect x="334" y="66" width="114" height="36" rx="7" fill="#0e1220" stroke="#1b2235" stroke-width="1.5"/>
            <text x="391" y="87" text-anchor="middle" font-size="11" fill="#7d7566" font-weight="400">Tool call</text>
          </g>

          <!-- Result -->
          <g id="ld-result">
            <rect x="499" y="66" width="112" height="36" rx="7" fill="#0e1220" stroke="#1b2235" stroke-width="1.5"/>
            <text x="555" y="87" text-anchor="middle" font-size="11" fill="#7d7566" font-weight="400">Result</text>
          </g>
        </svg>
      </div>

      <div class="ref-code-block">
        <div class="ref-code-block-header">A real loop — "Fix the auth bug"</div>
        <pre><code class="language-plaintext">You: "Fix the auth bug in login.ts"

  Claude thinks → calls Read("src/auth/login.ts")
  ← file contents

  Claude thinks → calls Grep("'await'", "src/auth/")
  ← finds missing awaits on line 47

  Claude thinks → calls Edit("src/auth/login.ts", ...)
  ← edit applied

  Claude thinks → calls Bash("npm test -- auth")
  ← tests pass

Claude: "Fixed. Missing await on verifyToken at line 47."</code></pre>
      </div>

      <ul class="ref-points">
        <li>
          <span class="rp-marker">Each step</span>
          <span>Every tool call is a round-trip to the model. Claude sees all previous results in its context before deciding what to do next.</span>
        </li>
        <li>
          <span class="rp-marker">Hooks</span>
          <span><strong>PreToolUse</strong> and <strong>PostToolUse</strong> hooks fire at the edges of each tool call — letting you log, validate, or transform inputs and outputs without changing the loop itself.</span>
        </li>
        <li>
          <span class="rp-marker">Subagents</span>
          <span>The Task tool spins up a child agent running its own independent loop with an isolated context window. Results are returned to the parent when the child finishes.</span>
        </li>
        <li>
          <span class="rp-marker">Stopping</span>
          <span>Claude decides when the task is complete. You can interrupt at any time, or use the <strong>Stop</strong> hook to run cleanup logic when a session ends.</span>
        </li>
      </ul>
    </div>

    <!-- ── MODELS ────────────────────────────────────────────── -->
    <div class="ref-section">
      <div class="ref-section-label">Foundations</div>
      <h2>Models</h2>
      <p class="ref-lead">Claude Code supports multiple Claude models. Each sits at a different point on the capability / speed / cost curve. The right choice depends on the complexity of the task — most work is fine on Sonnet, but heavy reasoning benefits from Opus, and fast repetitive tasks are better on Haiku.</p>

      <hr class="ref-divider">

      <div class="ref-code-block">
        <div class="ref-code-block-header">Model comparison</div>
        <pre><code class="language-plaintext">Model                   Speed     Cost    Best for
──────────────────────────────────────────────────────────────
claude-opus-4-6         Slower    High    Complex reasoning, architecture,
                                          deep refactors, planning
claude-sonnet-4-6       Fast      Mid     General coding tasks (default)
claude-haiku-4-5        Fastest   Low     Simple edits, quick questions,
                                          high-volume automation</code></pre>
      </div>

      <div class="ref-code-block">
        <div class="ref-code-block-header">Switching models</div>
        <pre><code class="language-bash"># CLI flag (one session)
claude --model claude-opus-4-6

# In-session toggle (Haiku ↔ Sonnet)
/fast

# Set default in ~/.claude/settings.json
{
  "model": "claude-sonnet-4-6"
}

# Per-agent in frontmatter
---
model: claude-opus-4-6   ← this agent always uses Opus
---</code></pre>
      </div>

      <ul class="ref-points">
        <li>
          <span class="rp-marker">Default</span>
          <span><strong>Sonnet</strong> is the default for interactive sessions — a good balance of quality and speed for everyday coding tasks.</span>
        </li>
        <li>
          <span class="rp-marker">Agents</span>
          <span>Individual agents can specify their own model in frontmatter. A code-reviewer might use Opus for thoroughness; a file-renamer might use Haiku for speed.</span>
        </li>
        <li>
          <span class="rp-marker">Cost</span>
          <span>Use <code>/cost</code> in any session to see token usage and estimated spend so far.</span>
        </li>
      </ul>
    </div>

    <!-- ── PROJECT STRUCTURE ─────────────────────────────────── -->
    <div class="ref-section">
      <div class="ref-section-label">Best Practices</div>
      <h2>Project Structure</h2>
      <p class="ref-lead">Claude Code config lives in two places: a global directory on your machine and a project directory inside your repo. Understanding the split is essential for team collaboration — some files are committed and shared, others are personal and gitignored.</p>

      <hr class="ref-divider">

      <div class="ref-code-block">
        <div class="ref-code-block-header">Annotated directory tree</div>
        <pre><code class="language-plaintext">~/.claude/                        # GLOBAL — personal, never committed
├── settings.json                 #   Permissions, env vars, hooks (all projects)
├── CLAUDE.md                     #   Your personal instructions (always loaded)
├── keybindings.json              #   Custom keyboard shortcuts
├── agents/                       #   Personal subagent definitions
├── skills/                       #   Personal agent skills
├── rules/                        #   Rules applied to all your projects
└── projects/
    └── &lt;project-hash&gt;/
        ├── session-id.jsonl      #   Full conversation logs
        └── memory/
            └── MEMORY.md         #   Auto-memory (first 200 lines loaded)

.claude/                          # PROJECT — committed to git, team-shared
├── settings.json                 #   Team permissions &amp; hooks  ← commit this
├── settings.local.json           #   Your personal overrides   ← gitignore
├── CLAUDE.md                     #   Project instructions      ← commit this
├── CLAUDE.local.md               #   Your personal notes       ← gitignore
├── agents/                       #   Project subagents         ← commit this
├── skills/                       #   Project agent skills      ← commit this
├── rules/                        #   Modular instruction files ← commit this
│   ├── code-style.md
│   └── frontend/react.md
└── .mcp.json                     #   Project MCP servers       ← commit this</code></pre>
      </div>

      <ul class="ref-points">
        <li>
          <span class="rp-marker">Commit</span>
          <span><strong>.claude/settings.json, CLAUDE.md, agents/, skills/, rules/, .mcp.json</strong> — anything your teammates should benefit from. These travel with the repo.</span>
        </li>
        <li>
          <span class="rp-marker">Gitignore</span>
          <span><strong>*.local.json and *.local.md</strong> files — these are personal overrides that shouldn't affect teammates. Add <code>.claude/settings.local.json</code> and <code>.claude/CLAUDE.local.md</code> to your <code>.gitignore</code>.</span>
        </li>
        <li>
          <span class="rp-marker">Global</span>
          <span><strong>~/.claude/</strong> is entirely personal. Defaults, preferences, and personal agents you want across all your projects go here — it never touches git.</span>
        </li>
        <li>
          <span class="rp-marker">Precedence</span>
          <span>When the same setting exists in multiple places: <strong>local &gt; project &gt; global</strong>. A <code>settings.local.json</code> override always wins.</span>
        </li>
      </ul>
    </div>

    <!-- ── SDLC BEST PRACTICES ──────────────────────────────── -->
    <div class="ref-section">
      <div class="ref-section-label">Best Practices</div>
      <h2>Claude Code in Your SDLC</h2>
      <p class="ref-lead">Claude Code fits naturally into every phase of the software development lifecycle — from planning a feature to shipping it. These patterns work well across solo projects and team codebases.</p>

      <hr class="ref-divider">

      <div class="ref-code-block">
        <div class="ref-code-block-header">Recommended workflow per task</div>
        <pre><code class="language-plaintext">1. Plan        /plan — propose approach, list files to touch
               ↓ you approve or redirect
2. Implement   Claude writes code in the agentic loop
               ↓ PostToolUse hooks auto-run formatters
3. Review      code-reviewer agent checks output
               ↓ findings grouped by severity
4. Test        qa agent or Bash("npm test") validates changes
               ↓ failures surface before commit
5. Commit      commit-helper skill writes the message
               ↓ git hooks run lint, typecheck, test
6. CI/CD       Headless: claude -p "..." in GitHub Actions</code></pre>
      </div>

      <div class="ref-code-block">
        <div class="ref-code-block-header">.github/workflows/claude-review.yml</div>
        <pre><code class="language-yaml">name: Claude Code Review
on: [pull_request]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }

      - name: Review PR diff with Claude
        run: |
          git diff origin/main...HEAD | \
          claude -p "Review this diff for bugs, security
            issues, and missed edge cases. Output Markdown
            grouped by severity: Critical / Warning / Info." \
            --output-format text > review.md
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}

      - name: Post review comment
        uses: actions/github-script@v7
        with:
          script: |
            const body = require('fs').readFileSync('review.md','utf8');
            github.rest.issues.createComment({
              ...context.repo,
              issue_number: context.issue.number, body
            });</code></pre>
      </div>

      <ul class="ref-points">
        <li>
          <span class="rp-marker">Plan first</span>
          <span>For any multi-file or architectural task, use <code>/plan</code> before implementation. Catching a wrong approach in the plan costs nothing; catching it after 10 tool calls costs tokens and time.</span>
        </li>
        <li>
          <span class="rp-marker">Hook automation</span>
          <span>Use <code>PostToolUse</code> hooks to run formatters (Prettier, gofmt, black) automatically on every file Claude writes. This keeps code clean without manual intervention or Claude forgetting to format.</span>
        </li>
        <li>
          <span class="rp-marker">Parallel review</span>
          <span>After implementation, spawn a <strong>code-reviewer</strong> and <strong>qa</strong> agent simultaneously via the Task tool. They run in parallel with isolated context — combined review + test in one round-trip.</span>
        </li>
        <li>
          <span class="rp-marker">CI integration</span>
          <span>Claude Code runs headless in GitHub Actions (or any CI). Pipe a PR diff through <code>claude -p</code> for automated review comments on every pull request — no human needed for first-pass review.</span>
        </li>
        <li>
          <span class="rp-marker">Context hygiene</span>
          <span>Run <code>/compact</code> at natural breakpoints — after finishing a feature, before starting the next. Keep <code>CLAUDE.md</code> under 500 lines. Use Grep/Glob for targeted reads instead of loading whole files.</span>
        </li>
      </ul>
    </div>

    <!-- ── CLAUDE.md BEST PRACTICES ────────────────────────── -->
    <div class="ref-section">
      <div class="ref-section-label">Best Practices</div>
      <h2>Writing Great CLAUDE.md Files</h2>
      <p class="ref-lead">CLAUDE.md is loaded fresh into Claude's context at the start of every session. It's the single highest-leverage thing you can configure. Writing it well dramatically improves quality and cuts token costs — writing it poorly does the opposite.</p>

      <hr class="ref-divider">

      <div class="loop-svg-wrap">
        <svg class="loop-svg" viewBox="0 0 640 210" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <marker id="pb-arr" viewBox="0 0 8 8" refX="7" refY="4" markerWidth="5" markerHeight="5" orient="auto">
              <path d="M0,0 L8,4 L0,8 Z" fill="#424955"/>
            </marker>
          </defs>

          <!-- ── Axes ── -->
          <line x1="72" y1="162" x2="72" y2="18" stroke="#2a3448" stroke-width="1.5" marker-end="url(#pb-arr)"/>
          <line x1="72" y1="162" x2="624" y2="162" stroke="#2a3448" stroke-width="1.5" marker-end="url(#pb-arr)"/>

          <!-- Y-axis label -->
          <text transform="translate(16,100) rotate(-90)" text-anchor="middle"
                font-size="9" fill="#424955" letter-spacing=".1em">REMEMBERED</text>

          <!-- X-axis label -->
          <text x="347" y="185" text-anchor="middle"
                font-size="9" fill="#424955" letter-spacing=".1em">POSITION IN CONTEXT</text>

          <!-- ── Curve fill ── -->
          <path d="M 86,42 C 168,150 258,155 348,155 C 438,155 528,150 610,42 L 610,162 L 86,162 Z"
                fill="rgba(212,168,83,0.06)"/>

          <!-- ── Curve stroke ── -->
          <path d="M 86,42 C 168,150 258,155 348,155 C 438,155 528,150 610,42"
                stroke="#d4a853" stroke-width="1.8" fill="none" stroke-opacity="0.5"/>

          <!-- ── X-axis ticks ── -->
          <line x1="86"  y1="159" x2="86"  y2="165" stroke="#2a3448" stroke-width="1.5"/>
          <line x1="610" y1="159" x2="610" y2="165" stroke="#2a3448" stroke-width="1.5"/>
          <text x="86"  y="177" text-anchor="middle" font-size="9.5" fill="#424955">Start</text>
          <text x="610" y="177" text-anchor="middle" font-size="9.5" fill="#424955">End</text>

          <!-- ── Middle annotation ── -->
          <line x1="348" y1="155" x2="348" y2="162" stroke="#2a3448" stroke-width="1" stroke-dasharray="3,2"/>
          <text x="348" y="178" text-anchor="middle" font-size="9" fill="#424955" letter-spacing=".04em">least remembered</text>

          <!-- ── Primacy dot + pulse + label ── -->
          <circle class="pb-ring" cx="86" cy="42" r="6" fill="none" stroke="#d4a853" stroke-width="1.2"/>
          <circle cx="86" cy="42" r="5" fill="#d4a853" opacity="0.9"/>
          <!-- dashed line up to label -->
          <line x1="86" y1="26" x2="86" y2="37" stroke="#d4a853" stroke-width="1" stroke-dasharray="2,2" opacity=".5"/>
          <!-- label box -->
          <rect x="22" y="10" width="90" height="22" rx="5" fill="#0e1220" stroke="#1b2235" stroke-width="1.5"/>
          <text x="67" y="25" text-anchor="middle" font-size="10" fill="#d4a853" font-weight="500">Primacy bias</text>

          <!-- ── Recency dot + pulse + label ── -->
          <circle class="pb-ring-delay" cx="610" cy="42" r="6" fill="none" stroke="#d4a853" stroke-width="1.2"/>
          <circle cx="610" cy="42" r="5" fill="#d4a853" opacity="0.9"/>
          <!-- dashed line up to label -->
          <line x1="610" y1="26" x2="610" y2="37" stroke="#d4a853" stroke-width="1" stroke-dasharray="2,2" opacity=".5"/>
          <!-- label box -->
          <rect x="528" y="10" width="90" height="22" rx="5" fill="#0e1220" stroke="#1b2235" stroke-width="1.5"/>
          <text x="573" y="25" text-anchor="middle" font-size="10" fill="#d4a853" font-weight="500">Recency bias</text>

          <!-- ── Guideline: put critical rules at top ── -->
          <line x1="86" y1="42" x2="86" y2="60" stroke="#d4a853" stroke-width="1" stroke-dasharray="3,2" opacity=".3"/>
          <text x="96" y="63" font-size="9" fill="#7d7566" letter-spacing=".03em">↑ put critical guardrails here</text>
        </svg>
      </div>

      <ul class="ref-points">
        <li>
          <span class="rp-marker">Run <code>/init</code></span>
          <span>The <code>/init</code> command analyzes your codebase and writes a starter CLAUDE.md with project context. Great starting point before customizing.</span>
        </li>
        <li>
          <span class="rp-marker">Size</span>
          <span>Keep CLAUDE.md between <strong>200–500 lines</strong>. It's loaded every session, so long files are expensive. If it grows larger, split into <code>.claude/rules/</code> files and <code>@</code>-include them.</span>
        </li>
        <li>
          <span class="rp-marker">Format</span>
          <span>Use <strong>bullet points and short headings</strong> rather than prose. Claude scans this file — structured content is processed more reliably than paragraphs.</span>
        </li>
        <li>
          <span class="rp-marker">Guardrails</span>
          <span>Put your most important rules <strong>at the top</strong> — things like "never delete files without confirmation" or "always run tests before marking tasks done". Primacy bias means these stick.</span>
        </li>
        <li>
          <span class="rp-marker">Living doc</span>
          <span>When Claude makes the same mistake twice, <strong>add a rule</strong>. Version-control your CLAUDE.md and prune it periodically — outdated rules add noise and cost tokens.</span>
        </li>
        <li>
          <span class="rp-marker">Avoid</span>
          <span>Don't dump entire style guides or API docs — that's very expensive and reduces quality. Don't write vague rules like "don't make any mistakes". Don't <code>@</code>-include huge files unless necessary.</span>
        </li>
      </ul>
    </div>

    <!-- ── CREDITS ─────────────────────────────────────────────── -->
    <div class="ref-credits">
      <div class="ref-credits-label">Sources &amp; Credit</div>

      <div class="ref-credits-row">
        <div class="ref-credits-icon">▶</div>
        <div class="ref-credits-body">
          <div class="ref-credits-name">
            <a href="https://www.youtube.com/watch?v=QoQBzR1NIqI" target="_blank" rel="noopener">
              Claude Code Full Course (4 Hours) — Nick Saraev
            </a>
          </div>
          <div class="ref-credits-desc">
            The concepts, examples, and best practices throughout this site are drawn primarily from Nick Saraev's comprehensive 2026 course on building and selling with Claude Code.
          </div>
        </div>
      </div>

      <div class="ref-credits-row">
        <div class="ref-credits-icon">◈</div>
        <div class="ref-credits-body">
          <div class="ref-credits-name">
            <a href="https://docs.anthropic.com/en/docs/claude-code/overview" target="_blank" rel="noopener">
              Claude Code Documentation — Anthropic
            </a>
          </div>
          <div class="ref-credits-desc">
            Official reference for all Claude Code features, settings, hooks, agents, and APIs.
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<div id="tooltip">
  <h3 id="tt-name"></h3>
  <p id="tt-desc"></p>
  <p class="tt-cat" id="tt-cat"></p>
</div>

<div id="panel">
  <div id="panel-resize"></div>
  <div class="p-head">
    <div class="p-cat" id="p-cat"></div>
    <div class="p-title" id="p-title"></div>
    <div id="p-badges"></div>
    <button id="p-close">✕</button>
  </div>
  <div class="p-body">
    <p class="p-desc" id="p-desc"></p>
    <div id="p-doclink"></div>
    <div id="p-examples"></div>
    <div id="p-related"></div>
  </div>
</div>

<button id="nav-back">← back</button>

<div id="legend">
  <div class="leg-title">Category</div>
  <div class="leg-item"><div class="leg-dot" style="background:#d4a853"></div><span class="leg-label">Core Concepts</span></div>
  <div class="leg-item"><div class="leg-dot" style="background:#5a8fc4"></div><span class="leg-label">Modes</span></div>
  <div class="leg-item"><div class="leg-dot" style="background:#5ea878"></div><span class="leg-label">Customization</span></div>
  <div class="leg-item"><div class="leg-dot" style="background:#9070c4"></div><span class="leg-label">Integration</span></div>
  <div class="leg-item"><div class="leg-dot" style="background:#a09080"></div><span class="leg-label">Detail</span></div>
</div>

<script>
// ═══════════════════════════════════════════════════════════════
// DATA
// ═══════════════════════════════════════════════════════════════

const COLORS = {
  core:          '#d4a853',   // gold  — Core Concepts
  modes:         '#5a8fc4',   // blue  — Modes
  config:        '#5ea878',   // green — Customization
  integration:   '#9070c4',   // purple — Integrations
  detail:        '#a09080',   // muted — L4 detail nodes
  extensibility: '#c46e5a',   // kept for existing node refs
  distribution:  '#5a8fc4',   // kept for existing node refs
};

const CAT_LABELS = {
  core: 'Core Concept', modes: 'Mode',
  config: 'Customization', integration: 'Integration',
  detail: 'Detail',
  extensibility: 'Extensibility', distribution: 'Distribution',
};

const INITIATED = {
  user:   { label: '↑ User-invoked',     cls: 'badge-user',   tip: 'You explicitly trigger this' },
  claude: { label: '⟳ Claude-invoked',   cls: 'badge-claude', tip: 'Claude decides when to use this' },
  both:   { label: '↕ User or Claude',   cls: 'badge-both',   tip: 'Either party can trigger this' },
  system: { label: '⚙ System-triggered', cls: 'badge-system', tip: 'Fires on lifecycle events' },
};

const nodes = [
  {
    id: 'claude-code', label: 'Claude Code', cat: 'core', r: 40,
    initiated: 'both',
    short: 'The agentic AI coding assistant. Everything else extends or configures it.',
    desc: 'Claude Code is Anthropic\'s agentic coding assistant. It can read, edit, and reason about your codebase, run commands, browse docs, and delegate tasks to subagents — all from a terminal or web interface.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/overview',
    docLabel: 'Claude Code overview',
    examples: [
      {
        filename: 'Project structure',
        label: 'Where Claude Code config lives',
        lang: 'plaintext',
        code: `.claude/
├── settings.json        ← behavior, hooks, plugins
├── CLAUDE.md            ← project context (always read)
├── agents/              ← custom subagent definitions
│   └── code-reviewer.md
├── skills/              ← Agent Skills (model-invoked)
│   └── pdf-processing/SKILL.md
├── commands/            ← Slash commands (user-invoked)
│   └── review.md
└── rules/               ← reusable rule snippets
    └── code-style.md
.mcp.json                ← MCP server config`,
      },
      {
        filename: 'CLAUDE.md',
        label: 'Best-practice project context file',
        lang: 'markdown',
        code: `# My Project

<!-- Run /init to auto-generate a starting CLAUDE.md from your codebase -->
<!-- Keep this file 200–500 lines. Split into rules/ if it grows larger. -->
<!-- Put critical guardrails at the TOP — Claude has primacy bias. -->

## Critical rules
- NEVER delete files without confirmation
- NEVER commit secrets or credentials

## Stack
- TypeScript, React, Node 20
- Postgres via Drizzle ORM
- Vitest for tests

## Conventions
- API routes live in \`src/routes/\`
- Use named exports, never default exports
- Run \`npm test\` before marking any task done

@.claude/rules/code-style.md`,
      },
    ],
  },
  {
    id: 'agent', label: 'Agent', cat: 'core', r: 30,
    initiated: 'both',
    short: 'A pre-configured AI personality for a specific task domain.',
    desc: 'Agents are pre-configured AI personalities — each with its own system prompt, tool access, model choice, and isolated context window. Claude Code can invoke them automatically based on context, or you can ask: "Use the code-reviewer agent." You can also wire agents into teams where a lead agent manages parallel subagents.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/sub-agents',
    docLabel: 'Subagents docs',
    examples: [
      {
        filename: '.claude/agents/code-reviewer.md',
        label: 'Example: Code Reviewer agent (all fields)',
        lang: 'markdown',
        code: `---
name: code-reviewer
description: Reviews code for correctness, security, and style.
  Invoked automatically after code changes or when asked to review.
tools: Read, Grep, Glob
model: claude-sonnet-4-6
maxTurns: 20
memory: project
---

You are a senior code reviewer. For every review:

1. Check code organization and structure
2. Look for error handling gaps
3. Flag security concerns (injections, secrets in source)
4. Suggest performance improvements
5. Verify test coverage exists

Group findings by severity: Critical / Warning / Info.`,
      },
      {
        filename: '.claude/agents/researcher.md',
        label: 'Example: Researcher agent',
        lang: 'markdown',
        code: `---
name: researcher
description: Researches technical topics, APIs, and libraries.
  Use when you need in-depth information before writing code.
tools: WebSearch, WebFetch, Read
model: claude-opus-4-6
maxTurns: 30
---

You are a technical researcher. When given a topic:

1. Search for official documentation first
2. Find real-world usage examples
3. Note any known gotchas or breaking changes
4. Return a concise Markdown summary with sources

Cite all sources. Never fabricate information.`,
      },
    ],
  },
  {
    id: 'subagent', label: 'Subagent\n(Task)', cat: 'core', r: 24,
    initiated: 'claude',
    short: 'A child agent Claude autonomously spawns to handle a subtask in parallel.',
    desc: 'When Claude uses the Task tool, it spawns a subagent with its own isolated context window and loop. Subagents work concurrently and report back to the parent — enabling parallel workstreams. Note: spawning subagents is expensive (~7× more tokens than a linear approach), so it\'s most valuable for tasks that genuinely benefit from parallelism or isolation. The three most useful subagents: Code Reviewer, Researcher, and QA.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/sub-agents',
    docLabel: 'Subagents docs',
    examples: [
      {
        filename: 'Parallelization pattern',
        label: 'Running 3 subagents simultaneously',
        lang: 'plaintext',
        code: `# Claude spawns all three at once via Task tool:

  ┌─ Subagent 1: Code Reviewer ─────────────────┐
  │  tools: Read, Grep, Glob                    │
  │  → returns: severity-grouped findings       │
  └─────────────────────────────────────────────┘

  ┌─ Subagent 2: QA ────────────────────────────┐
  │  tools: Bash, Read                          │
  │  → returns: test run results & failures     │
  └─────────────────────────────────────────────┘

  ┌─ Subagent 3: Researcher ────────────────────┐
  │  tools: WebSearch, WebFetch                 │
  │  → returns: relevant docs & examples        │
  └─────────────────────────────────────────────┘

Parent agent aggregates all results and responds.
Cost: ~7× more tokens than sequential — use wisely.`,
      },
      {
        filename: '.claude/agents/qa.md',
        label: 'Example: QA subagent',
        lang: 'markdown',
        code: `---
name: qa
description: Runs tests, checks for regressions, and validates
  that changes work as expected. Use after code changes.
tools: Bash, Read, Glob
model: claude-sonnet-4-6
maxTurns: 25
---

You are a QA engineer. For each task:

1. Run the full test suite: \`npm test\`
2. Run linting: \`npm run lint\`
3. Check for type errors: \`npm run typecheck\`
4. Report any failures with file and line references
5. Suggest fixes for each failure

Never mark a task done if tests are failing.`,
      },
    ],
  },
  {
    id: 'headless', label: 'Headless\nMode', cat: 'core', r: 22,
    initiated: 'user',
    short: 'Run Claude Code non-interactively — for CI/CD and scripting.',
    desc: 'Headless mode lets you run Claude Code without a UI via the CLI, making it ideal for automation, CI pipelines, and scripts. Pass a prompt with -p and pipe output to other tools.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/cli-reference',
    docLabel: 'CLI reference docs',
    examples: [
      {
        filename: 'shell',
        label: 'Headless CLI usage',
        lang: 'bash',
        code: `# One-shot prompt
claude -p "Fix all TypeScript errors in src/"

# Pipe a diff for review
git diff HEAD~1 | claude -p "Flag any security issues in this diff"

# JSON output for scripting
claude -p "List all TODO comments" --output-format json | jq .

# Use in a CI step
claude -p "Run tests and fix failures" --allowedTools Bash,Read,Edit`,
      },
      {
        filename: '.github/workflows/review.yml',
        label: 'GitHub Actions CI step',
        lang: 'yaml',
        code: `- name: Claude Code review
  run: |
    claude -p "Review the PR diff for security issues.
    Output a Markdown summary." \\
    --output-format text \\
    > review.md
  env:
    ANTHROPIC_API_KEY: \${{ secrets.ANTHROPIC_API_KEY }}`,
      },
    ],
  },
  {
    id: 'plugin', label: 'Plugin', cat: 'extensibility', r: 34,
    initiated: 'user',
    short: 'A shareable bundle of commands, agents, skills, hooks, and MCP servers.',
    desc: 'Plugins extend Claude Code with custom functionality packaged as a directory. They can include slash commands, subagent definitions, Agent Skills, hooks, and MCP server configs — all shareable via a marketplace.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/plugins',
    docLabel: 'Plugins docs',
    examples: [
      {
        filename: 'Plugin directory structure',
        label: 'Standard plugin layout',
        lang: 'plaintext',
        code: `my-plugin/
├── .claude-plugin/
│   └── plugin.json       ← manifest (required)
├── commands/
│   └── deploy.md         ← slash commands
├── agents/
│   └── deployer.md       ← subagent definitions
├── skills/
│   └── k8s/SKILL.md      ← Agent Skills
├── hooks/
│   └── hooks.json        ← lifecycle hooks
└── .mcp.json             ← MCP server config`,
      },
      {
        filename: '.claude-plugin/plugin.json',
        label: 'Plugin manifest',
        lang: 'json',
        code: `{
  "name": "deploy-toolkit",
  "version": "1.0.0",
  "description": "Kubernetes deployment commands and agents",
  "author": { "name": "My Org", "email": "dev@example.com" },
  "license": "MIT",
  "keywords": ["kubernetes", "deployment", "ci-cd"]
}`,
      },
    ],
  },
  {
    id: 'command', label: 'Slash\nCommand', cat: 'extensibility', r: 24,
    initiated: 'user',
    short: 'A custom /command you type explicitly to trigger a workflow.',
    desc: 'Slash commands are user-invoked — you type /command-name to run them. Defined as Markdown files, Claude reads the file and follows its instructions when you invoke the command. Project commands live in .claude/commands/.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/slash-commands',
    docLabel: 'Slash commands docs',
    examples: [
      {
        filename: 'File location',
        label: 'Where slash commands live',
        lang: 'plaintext',
        code: `.claude/
└── commands/
    ├── review.md          ← /review
    ├── deploy.md          ← /deploy
    └── standup.md         ← /standup

~/.claude/commands/        ← personal commands (all projects)`,
      },
      {
        filename: '.claude/commands/review.md',
        label: 'Example: /review command',
        lang: 'markdown',
        code: `---
description: Run a full code review on staged changes
---

# Code Review

1. Run \`git diff --staged\` to see what's changing
2. For each changed file, check:
   - Logic correctness and edge cases
   - Error handling completeness
   - Security concerns
   - Test coverage
3. Summarize findings by severity: Critical / Warning / Info
4. Suggest specific fixes with file and line references`,
      },
      {
        filename: '.claude/commands/standup.md',
        label: 'Example: /standup command',
        lang: 'markdown',
        code: `---
description: Generate a standup from recent git activity
---

# Daily Standup

1. Run \`git log --since="24 hours ago" --oneline\`
2. Group commits by feature area
3. Output a Markdown standup:
   - **Yesterday**: what was completed
   - **Today**: what's planned
   - **Blockers**: failing tests or open issues`,
      },
    ],
  },
  {
    id: 'skill', label: 'Agent\nSkill', cat: 'extensibility', r: 26,
    initiated: 'claude',
    short: 'Claude autonomously decides when to use this based on your request.',
    desc: 'Agent Skills are model-invoked — you don\'t call them, Claude does. Each skill is a folder with a SKILL.md file whose description tells Claude when to activate it. When your request matches, Claude reads the instructions and follows them.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/skills',
    docLabel: 'Agent Skills docs',
    examples: [
      {
        filename: 'File location',
        label: 'Where skills live',
        lang: 'plaintext',
        code: `.claude/
└── skills/
    ├── commit-helper/
    │   └── SKILL.md       ← auto-used when writing commits
    ├── pdf-processing/
    │   ├── SKILL.md
    │   └── scripts/extract.py
    └── api-docs/
        ├── SKILL.md
        └── reference.md

~/.claude/skills/          ← personal skills (all projects)`,
      },
      {
        filename: '.claude/skills/commit-helper/SKILL.md',
        label: 'Example: Commit message skill',
        lang: 'markdown',
        code: `---
name: generating-commit-messages
description: Generates clear, conventional commit messages
  from git diffs. Use when writing commit messages or
  reviewing staged changes.
---

# Generating Commit Messages

## Instructions

1. Run \`git diff --staged\` to see changes
2. Identify type: feat / fix / chore / docs / refactor / test
3. Write a summary under 50 characters
4. Add a body explaining *why*, not just *what*

## Format
\`\`\`
<type>(<scope>): <summary under 50 chars>

<body: explain motivation and impact>
\`\`\``,
      },
      {
        filename: '.claude/skills/pdf-processing/SKILL.md',
        label: 'Example: PDF processing skill',
        lang: 'markdown',
        code: `---
name: pdf-processing
description: Extract text, fill forms, merge PDFs. Use when
  working with PDF files or document extraction.
allowed-tools: Read, Bash
---

# PDF Processing

\`\`\`python
import pdfplumber
with pdfplumber.open("doc.pdf") as pdf:
    text = pdf.pages[0].extract_text()
print(text)
\`\`\`

## Requirements
\`pip install pypdf pdfplumber\``,
      },
    ],
  },
  {
    id: 'hook', label: 'Hook', cat: 'extensibility', r: 23,
    initiated: 'system',
    short: 'Runs automatically on Claude Code lifecycle events.',
    desc: 'Hooks fire on events like PreToolUse, PostToolUse, Stop, SessionStart, and UserPromptSubmit. They can allow/deny actions, inject context, run formatters, send notifications, or validate commands — without user interaction.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/hooks',
    docLabel: 'Hooks guide',
    examples: [
      {
        filename: '.claude/settings.json',
        label: 'Format on write + validate prompts',
        lang: 'json',
        code: `{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [{
          "type": "command",
          "command": "prettier --write \\"$TOOL_INPUT_FILE_PATH\\"",
          "timeout": 30
        }]
      }
    ],
    "UserPromptSubmit": [
      {
        "hooks": [{
          "type": "command",
          "command": "$CLAUDE_PROJECT_DIR/.claude/hooks/validate-prompt.sh"
        }]
      }
    ],
    "SessionStart": [
      {
        "hooks": [{
          "type": "command",
          "command": "echo \\"Session: $(date)\\" >> ~/.claude/sessions.log"
        }]
      }
    ]
  }
}`,
      },
      {
        filename: '.claude/hooks/validate-prompt.sh',
        label: 'Example: Prompt validator script',
        lang: 'bash',
        code: `#!/bin/bash
# Receives hook input via stdin as JSON
INPUT=$(cat)
PROMPT=$(echo "$INPUT" | jq -r '.prompt')

# Block prompts containing raw secrets
if echo "$PROMPT" | grep -qiE '(password|api_key|secret)\\s*[:=]\\s*\\S+'; then
  echo "Blocked: prompt appears to contain a secret" >&2
  exit 2
fi

# Inject current branch as context
BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null)
echo "Current git branch: $BRANCH"
exit 0`,
      },
    ],
  },
  {
    id: 'output-style', label: 'Output\nStyle', cat: 'extensibility', r: 20,
    initiated: 'user',
    short: 'Customize how Claude formats and presents its responses.',
    desc: 'Output styles modify Claude\'s system prompt to change tone, verbosity, and format. Built-ins include Default and Explanatory. You can write custom styles as Markdown files and activate them with /output-style.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/output-styles',
    docLabel: 'Output styles docs',
    examples: [
      {
        filename: 'File location',
        label: 'Where output styles live',
        lang: 'plaintext',
        code: `.claude/output-styles/
└── concise.md         ← project-level style

~/.claude/output-styles/   ← personal styles

# Activate with:
# /output-style concise`,
      },
      {
        filename: '.claude/output-styles/concise.md',
        label: 'Example: Concise output style',
        lang: 'markdown',
        code: `---
name: Concise
description: Ultra-brief responses — bullets over prose,
  no preamble, no affirmations.
keep-coding-instructions: true
---

Respond as briefly as possible at all times.
- Use bullet points instead of prose
- Never explain your reasoning unless explicitly asked
- Skip all pleasantries: no "Great!", "Sure!", "Of course!"
- For code: show the code, skip the explanation
- If you need to clarify, ask only one question`,
      },
    ],
  },
  {
    id: 'marketplace', label: 'Marketplace', cat: 'distribution', r: 28,
    initiated: 'user',
    short: 'A catalog of plugins — local folder, Git repo, or hosted registry.',
    desc: 'A marketplace is a directory or Git repository with a marketplace.json listing available plugins. Register marketplaces in settings.json and install plugins from them — great for sharing tooling across a team or org.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/plugin-marketplaces',
    docLabel: 'Plugin marketplaces docs',
    examples: [
      {
        filename: 'marketplace.json',
        label: 'Marketplace manifest',
        lang: 'json',
        code: `{
  "name": "my-org-plugins",
  "owner": { "name": "My Org" },
  "plugins": [
    {
      "name": "code-reviewer",
      "source": "./code-reviewer",
      "description": "Automated code review tools"
    },
    {
      "name": "deploy-helper",
      "source": "./deploy-helper",
      "description": "Kubernetes deployment commands"
    }
  ]
}`,
      },
      {
        filename: '.claude/settings.json',
        label: 'Register & install from a marketplace',
        lang: 'json',
        code: `{
  "plugins": {
    "marketplaces": [
      "github.com/my-org/claude-plugins"
    ],
    "installed": [
      "code-reviewer@my-org",
      "deploy-helper@my-org"
    ]
  }
}`,
      },
    ],
  },
  {
    id: 'settings', label: 'Settings', cat: 'config', r: 24,
    initiated: 'user',
    short: '.claude/settings.json — configures hooks, plugins, permissions, and more.',
    desc: 'Settings files configure Claude Code at user, project, or enterprise level. They control hooks, auto-installed plugins, permission modes, and other behavior. Project settings are committed to git and shared with the team.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/settings',
    docLabel: 'Settings docs',
    examples: [
      {
        filename: 'File precedence',
        label: 'Settings file hierarchy',
        lang: 'plaintext',
        code: `~/.claude/settings.json          ← global  (personal, all projects)
.claude/settings.json            ← project (committed, team-shared)
.claude/settings.local.json      ← local   (personal overrides, gitignored)

Priority: local > project > global`,
      },
      {
        filename: '.claude/settings.json',
        label: 'Example: Full project settings',
        lang: 'json',
        code: `{
  "plugins": {
    "marketplaces": ["github.com/my-org/claude-plugins"],
    "installed": ["code-reviewer@my-org"]
  },
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [{
          "type": "command",
          "command": "prettier --write \\"$TOOL_INPUT_FILE_PATH\\""
        }]
      }
    ]
  },
  "permissions": {
    "allow": ["Bash(npm run *)", "Bash(git *)"],
    "deny": ["Bash(rm -rf *)"]
  }
}`,
      },
    ],
  },
  {
    id: 'mcp', label: 'MCP\nServer', cat: 'integration', r: 27,
    initiated: 'claude',
    short: 'Connects Claude to external tools, APIs, and data sources.',
    desc: 'MCP (Model Context Protocol) servers expose tools that Claude autonomously calls — databases, GitHub, JIRA, Sentry, file systems, and more. Servers can be local (stdio) or remote (HTTP/SSE). Config lives in .mcp.json.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/mcp',
    docLabel: 'MCP docs',
    examples: [
      {
        filename: '.mcp.json',
        label: 'GitHub + Postgres MCP servers',
        lang: 'json',
        code: `{
  "mcpServers": {
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "\${GITHUB_TOKEN}"
      }
    },
    "postgres": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-postgres",
        "postgresql://localhost/mydb"
      ]
    },
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "."]
    }
  }
}`,
      },
      {
        filename: 'shell',
        label: 'Manage MCP servers via CLI',
        lang: 'bash',
        code: `# Add a remote HTTP server
claude mcp add --transport http notion https://mcp.notion.com/mcp

# Add a local stdio server
claude mcp add --transport stdio github \\
  npx -y @modelcontextprotocol/server-github

# List configured servers
claude mcp list

# Remove a server
claude mcp remove github`,
      },
    ],
  },
  {
    id: 'tools', label: 'Tools', cat: 'core', r: 26,
    initiated: 'claude',
    short: 'The built-in primitives Claude uses to read, write, run, and browse.',
    desc: 'Tools are the atomic operations Claude calls to interact with your environment — reading files, running shell commands, searching code, browsing the web. Agents declare which tools they can access; MCP servers add new ones; permissions control which run automatically.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/tools',
    docLabel: 'Tools reference',
    examples: [
      {
        filename: 'Built-in tool reference',
        label: 'All tools available to Claude Code',
        lang: 'plaintext',
        code: `── File ──────────────────────────────────────────
Read          Read any file's contents
Write         Create or overwrite a file
Edit          Precise find-and-replace in a file
MultiEdit     Multiple edits to one file in one call

── Search ────────────────────────────────────────
Glob          Find files by pattern (e.g. **/*.ts)
Grep          Search file contents with regex
LS            List directory contents

── Execution ─────────────────────────────────────
Bash          Run any shell command
Task          Spawn a specialized subagent

── Web ───────────────────────────────────────────
WebFetch      Fetch a URL, extract content as text
WebSearch     Search the web, return ranked results

── Notebooks ─────────────────────────────────────
NotebookRead  Read Jupyter notebook cells
NotebookEdit  Insert, replace, or delete cells

── UI (interactive sessions only) ───────────────
AskUserQuestion   Prompt the user for a choice
TodoWrite         Create/update a task checklist
EnterPlanMode     Switch to plan-before-code mode
ExitPlanMode      Signal plan is ready for approval`,
      },
      {
        filename: '.claude/settings.json',
        label: 'Controlling tool access via permissions',
        lang: 'json',
        code: `{
  "permissions": {
    "allow": [
      "Read(**)",
      "Glob(**)",
      "Grep(**)",
      "Bash(git *)",
      "Bash(npm test)",
      "Bash(npm run lint)",
      "Write(src/**)",
      "Edit(src/**)"
    ],
    "deny": [
      "Bash(rm -rf *)",
      "Bash(curl *)",
      "WebFetch(*)",
      "Bash(git push *)"
    ]
  }
}`,
      },
      {
        filename: '.claude/agents/code-reviewer.md',
        label: 'Agents declare their tool subset',
        lang: 'markdown',
        code: `---
name: code-reviewer
description: Reviews code for quality and security.
tools: Read, Grep, Glob
# ^ Only these three tools — no Bash, no Write.
#   Keeps the agent read-only and safe.
model: claude-sonnet-4-6
---

You are a senior code reviewer ...`,
      },
    ],
  },
  {
    id: 'plan-mode', label: 'Plan\nMode', cat: 'core', r: 22,
    initiated: 'user',
    short: 'Ask Claude to plan before it builds — prevents costly wrong-direction work.',
    desc: 'Plan Mode is a first-class workflow in Claude Code: Claude proposes a full approach before touching any files. The built-in EnterPlanMode and ExitPlanMode tools make this explicit — you approve the plan, then implementation begins. Especially important for multi-file changes, architectural decisions, or any task with multiple valid approaches.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/how-claude-thinks',
    docLabel: 'How Claude thinks',
    examples: [
      {
        filename: 'Invoking plan mode',
        label: 'How to trigger planning before building',
        lang: 'plaintext',
        code: `# Explicit ask (works always)
"Before writing any code, plan your approach."
"Think step by step about how you'd implement this."
"What files would you need to change? Plan first."

# Built-in slash command
/plan

# In CLAUDE.md — enforce planning on complex tasks
## Workflow
For tasks touching more than 2 files, always use
EnterPlanMode and list every file you will modify
before writing a single line of code.`,
      },
      {
        filename: 'Why plan first?',
        label: 'The cost of skipping the plan',
        lang: 'plaintext',
        code: `Without a plan:
  Claude starts writing → realizes it needs to
  refactor → context fills with wrong attempts →
  you interrupt → start over. Expensive.

With a plan:
  Claude maps out files, data flow, edge cases →
  you spot the flaw before any code is written →
  redirect costs nothing.

Rule of thumb:
  If you'd ask a senior engineer to whiteboard
  it first, ask Claude to plan first too.`,
      },
      {
        filename: '.claude/CLAUDE.md',
        label: 'Enforce plan-first in your CLAUDE.md',
        lang: 'markdown',
        code: `## Workflow

For any task touching more than 2 files:
1. Use \`EnterPlanMode\` — write out the full approach
2. List every file you will create or modify
3. Note any trade-offs or alternative approaches
4. Wait for approval before writing any code

For simple, single-file changes: proceed directly.`,
      },
    ],
  },
  {
    id: 'claude-md', label: 'CLAUDE.md', cat: 'config', r: 26,
    initiated: 'user',
    short: 'A Markdown file Claude reads at session start — your persistent project instructions.',
    desc: 'CLAUDE.md is loaded fresh into Claude\'s context at the start of every session. It\'s how you give Claude persistent instructions without repeating yourself. Run /init to auto-generate one from your codebase. Keep it 200–500 lines; put critical guardrails at the top (Claude has primacy bias). Split into .claude/rules/ files if it grows too large.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/memory',
    docLabel: 'Memory & CLAUDE.md docs',
    examples: [
      {
        filename: 'CLAUDE.md',
        label: 'Do\'s and Don\'ts for CLAUDE.md',
        lang: 'markdown',
        code: `# My Project

<!-- ✅ DO: Run /init to generate a starter file from your codebase  -->
<!-- ✅ DO: Put most important guardrails at the TOP (primacy bias)  -->
<!-- ✅ DO: Use bullet points & short headings — not prose paragraphs -->
<!-- ✅ DO: Keep to 200–500 lines. Split into rules/ if larger.      -->
<!-- ✅ DO: Version-control & review regularly (treat as living code) -->
<!-- ✅ DO: Add a rule when Claude keeps making the same mistake      -->

<!-- ❌ DON'T: Dump style guides / full API docs (very expensive)    -->
<!-- ❌ DON'T: Write vague rules like "don't make any mistakes"      -->
<!-- ❌ DON'T: @-include huge files unless absolutely necessary      -->

## Critical guardrails
- NEVER delete files without confirmation
- NEVER commit secrets or credentials
- Always run \`npm test\` before marking tasks done

## Stack
- TypeScript, React 18, Node 20
- Postgres via Drizzle ORM, Vitest

## Conventions
- Named exports only — no default exports
- API routes in \`src/routes/\`

@.claude/rules/code-style.md`,
      },
      {
        filename: 'CLAUDE.md hierarchy',
        label: 'Three layers — enterprise → global → project',
        lang: 'plaintext',
        code: `CLAUDE.md is loaded from three layers (all merged):

  1. Enterprise policy (managed by admin, always loaded)
     e.g. company-wide security rules

  2. Global personal  ~/.claude/CLAUDE.md
     + ~/.claude/rules/*.md
     Your instructions across ALL projects

  3. Project local  .claude/CLAUDE.md
     + .claude/rules/*.md
     + .claude/MEMORY.md  ← auto-memory (first 200 lines)
     Shared with team via git

Splitting example:
  .claude/
  ├── CLAUDE.md             ← main file (short summary + @includes)
  └── rules/
      ├── code-style.md     ← @.claude/rules/code-style.md
      └── frontend/
          └── react.md      ← @.claude/rules/frontend/react.md`,
      },
    ],
  },
  {
    id: 'frontmatter', label: 'Frontmatter', cat: 'extensibility', r: 20,
    initiated: 'user',
    short: 'YAML metadata between --- delimiters that configures agents, skills, and commands.',
    desc: 'Frontmatter is the block of YAML between --- delimiters at the very top of a Markdown file. In Claude Code, it\'s how you configure agents, skills, and slash commands — declaring their name, description, which tools they can use, and which model to run on. Claude reads the description field to decide when to invoke a skill or agent automatically.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/sub-agents',
    docLabel: 'Agents & frontmatter docs',
    examples: [
      {
        filename: 'Agent frontmatter',
        label: 'All fields for .claude/agents/*.md',
        lang: 'markdown',
        code: `---
name: code-reviewer
description: >
  Reviews code for correctness, security, and style.
  Invoked automatically after edits or on request.
tools: Read, Glob, Grep
model: claude-sonnet-4-6
maxTurns: 20          # max agentic loop iterations
memory: project       # load project CLAUDE.md into context
---

System prompt for the agent goes here...`,
      },
      {
        filename: 'Skill frontmatter',
        label: 'All fields for .claude/skills/*/SKILL.md',
        lang: 'markdown',
        code: `---
name: commit-helper
description: >
  Generates conventional commit messages from staged diffs.
  Use when writing or reviewing a git commit.
allowed-tools: Bash, Read
---

Skill instructions go here...`,
      },
      {
        filename: 'Command frontmatter',
        label: 'Fields for .claude/commands/*.md',
        lang: 'markdown',
        code: `---
description: Run a full code review on staged changes
---

Slash command instructions go here...

# $ARGUMENTS placeholder passes CLI args
# e.g. /review src/auth.ts → $ARGUMENTS = "src/auth.ts"`,
      },
    ],
  },

  // ── L2 Category Nodes ──────────────────────────────────────────
  {
    id: 'modes', label: 'Modes', cat: 'modes', r: 34,
    initiated: 'user',
    short: 'How Claude Code operates — interactive, headless, plan, or agent.',
    desc: 'Claude Code can be run in several modes: Interactive for conversational coding, Plan Mode for proposal-first workflow, Headless for CI/CD automation, and Agent Mode for autonomous multi-agent orchestration.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/overview',
    docLabel: 'Claude Code overview',
    examples: [
      {
        filename: 'Mode overview',
        label: 'When to use each mode',
        lang: 'plaintext',
        code: `Interactive  claude            Default — conversational coding
Plan Mode    /plan             Propose before building
Headless     claude -p "..."   CI/CD, scripts, automation
Agent Mode   Task tool         Parallel subagent orchestration`,
      },
    ],
  },
  {
    id: 'core-concepts', label: 'Core\nConcepts', cat: 'core', r: 34,
    initiated: 'both',
    short: 'The foundational building blocks: tools, agents, context, and permissions.',
    desc: 'Claude Code is built on four core concepts: Tools (the primitives Claude calls to interact with your system), Agents (pre-configured AI personalities for specific tasks), Context & Memory (what Claude can see), and Permissions (what Claude is allowed to do).',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/overview',
    docLabel: 'Claude Code overview',
    examples: [],
  },
  {
    id: 'customization', label: 'Customization', cat: 'config', r: 34,
    initiated: 'user',
    short: 'Configure Claude Code with CLAUDE.md, Settings, Skills, and Hooks.',
    desc: 'Claude Code is highly customizable: CLAUDE.md provides persistent instructions loaded every session, Settings configure behavior and permissions, Skills let Claude invoke specialized workflows automatically, and Hooks automate lifecycle events without user interaction.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/settings',
    docLabel: 'Settings & customization docs',
    examples: [],
  },
  {
    id: 'integrations', label: 'Integrations', cat: 'integration', r: 34,
    initiated: 'user',
    short: 'Connect Claude Code to external tools via MCP, plugins, and IDEs.',
    desc: 'Claude Code connects to external systems via MCP servers (databases, GitHub, JIRA, APIs), the Plugin system for shareable workflow bundles, and IDE integrations for VS Code, JetBrains, and other editors.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/mcp',
    docLabel: 'MCP & integrations docs',
    examples: [],
  },

  // ── L3 Concept Nodes ───────────────────────────────────────────
  {
    id: 'interactive-mode', label: 'Interactive\nMode', cat: 'modes', r: 26,
    initiated: 'user',
    short: 'The default mode — conversational coding with live tool execution.',
    desc: 'Interactive mode is Claude Code\'s primary interface. You type prompts, Claude thinks and calls tools (Read, Edit, Bash, etc.) in a live loop, showing results as it goes. Perfect for exploratory coding, debugging, and collaborative development. Just run `claude` to start.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/getting-started',
    docLabel: 'Getting started docs',
    examples: [
      {
        filename: 'shell',
        label: 'Starting an interactive session',
        lang: 'bash',
        code: `# Start interactive session
claude

# With specific model
claude --model claude-opus-4-6

# With restricted tools
claude --allowedTools Read,Grep,Glob

# Common in-session commands
/plan    # enter plan mode
/compact # summarize history to save tokens
/cost    # see token usage
/clear   # start fresh`,
      },
    ],
  },
  {
    id: 'agent-mode', label: 'Agent\nMode', cat: 'modes', r: 26,
    initiated: 'both',
    short: 'Autonomous multi-agent execution — Claude delegates to parallel subagents.',
    desc: 'Agent mode allows Claude to autonomously orchestrate multiple subagents for complex tasks. A lead agent breaks down work and spawns specialized child agents (code reviewer, QA, researcher) that run in parallel with isolated context windows, then aggregates their results.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/sub-agents',
    docLabel: 'Subagents & agent mode docs',
    examples: [
      {
        filename: 'Agent mode pattern',
        label: 'Spawning parallel specialist agents',
        lang: 'plaintext',
        code: `You: "Review my PR, run tests, and research alternatives"

Lead Claude spawns 3 agents simultaneously:

  ┌─ Code Reviewer ──────────────────────────────┐
  │  tools: Read, Grep, Glob                     │
  │  → returns: severity-grouped findings        │
  └──────────────────────────────────────────────┘

  ┌─ QA Agent ───────────────────────────────────┐
  │  tools: Bash, Read                           │
  │  → returns: test pass/fail + errors          │
  └──────────────────────────────────────────────┘

  ┌─ Researcher ─────────────────────────────────┐
  │  tools: WebSearch, WebFetch                  │
  │  → returns: docs + alternatives              │
  └──────────────────────────────────────────────┘

Parent aggregates all results and responds.`,
      },
    ],
  },
  {
    id: 'context-memory', label: 'Context\n& Memory', cat: 'core', r: 26,
    initiated: 'both',
    short: 'Claude\'s working memory: the context window, CLAUDE.md, and auto-memory.',
    desc: 'Claude\'s context window (~200k tokens) holds everything it can see: your conversation, loaded file contents, tool results, CLAUDE.md, and the system prompt. Memory across sessions comes from CLAUDE.md (loaded fresh each time) and auto-memory files in the project memory directory.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/memory',
    docLabel: 'Memory & context docs',
    examples: [
      {
        filename: 'Context window contents',
        label: 'What lives in Claude\'s working memory',
        lang: 'plaintext',
        code: `┌─────────────────────────────────────────────────────┐
│  Context Window  (~200,000 tokens for Sonnet/Opus)  │
│                                                     │
│  System prompt              ~500–2,000 tokens       │
│  CLAUDE.md (loaded fresh)   variable                │
│  Conversation history       grows over time         │
│  File contents              (each Read adds tokens) │
│  Tool call results          (Bash output, searches) │
│  Auto-memory/MEMORY.md      first 200 lines         │
│                                                     │
└─────────────────────────────────────────────────────┘

Use /compact to summarize history and reclaim space.`,
      },
    ],
  },
  {
    id: 'permissions', label: 'Permissions', cat: 'core', r: 26,
    initiated: 'user',
    short: 'Control which tools Claude can use via allow/deny lists in settings.json.',
    desc: 'Permissions govern what Claude Code can do in your environment. Use allow and deny lists in settings.json to control which Bash commands, file paths, and tools Claude can use without asking. Trust modes let you balance safety and workflow speed.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/settings',
    docLabel: 'Permissions & settings docs',
    examples: [
      {
        filename: '.claude/settings.json',
        label: 'Allow/deny permission patterns',
        lang: 'json',
        code: `{
  "permissions": {
    "allow": [
      "Read(**)",
      "Glob(**)",
      "Grep(**)",
      "Bash(git *)",
      "Bash(npm test)",
      "Bash(npm run lint)",
      "Write(src/**)",
      "Edit(src/**)"
    ],
    "deny": [
      "Bash(rm -rf *)",
      "Bash(curl *)",
      "WebFetch(*)",
      "Bash(git push --force *)"
    ]
  }
}`,
      },
    ],
  },
  {
    id: 'skills', label: 'Skills &\nCommands', cat: 'config', r: 26,
    initiated: 'both',
    short: 'Agent Skills (auto-invoked), slash commands (user-invoked), and output styles.',
    desc: 'Claude Code\'s skill system includes Agent Skills (Claude invokes automatically based on context), Slash Commands (you invoke explicitly with /command-name), Output Styles (customize Claude\'s response format), and the Marketplace for sharing plugin bundles with your team.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/skills',
    docLabel: 'Skills & commands docs',
    examples: [
      {
        filename: 'Directory layout',
        label: 'Where skills and commands live',
        lang: 'plaintext',
        code: `.claude/
├── skills/            ← Agent Skills (Claude-invoked)
│   └── commit-helper/
│       └── SKILL.md
├── commands/          ← Slash commands (user-invoked)
│   ├── review.md      ← /review
│   └── deploy.md      ← /deploy
└── output-styles/     ← Response format presets
    └── concise.md     ← /output-style concise

~/.claude/skills/      ← personal skills (all projects)
~/.claude/commands/    ← personal commands`,
      },
    ],
  },
  {
    id: 'ide-integrations', label: 'IDE\nIntegrations', cat: 'integration', r: 26,
    initiated: 'user',
    short: 'Claude Code integrations for VS Code, JetBrains, and other editors.',
    desc: 'Claude Code integrates directly into popular IDEs: VS Code via a marketplace extension, JetBrains IDEs (IntelliJ, PyCharm, WebStorm, etc.), and more. IDE integrations bring Claude\'s capabilities into your editor — inline edits, context-aware suggestions, and terminal access without switching windows.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/ide-integrations',
    docLabel: 'IDE integrations docs',
    examples: [
      {
        filename: 'IDE setup',
        label: 'Setting up Claude Code in your editor',
        lang: 'bash',
        code: `# VS Code — install from marketplace:
# Search "Claude Code" in Extensions (Ctrl+Shift+X)
# Or via CLI:
code --install-extension anthropic.claude-code

# JetBrains — install from JetBrains Marketplace:
# Settings → Plugins → search "Claude Code"

# After installing, the claude terminal opens in
# your IDE's integrated terminal with full access
# to your project files and git context.`,
      },
    ],
  },

  // ── L4 Detail Nodes ────────────────────────────────────────────
  {
    id: 'tool-bash', label: 'Bash', cat: 'detail', r: 20,
    initiated: 'claude',
    short: 'Run any shell command: git, npm, tests, scripts.',
    desc: 'The Bash tool lets Claude run any shell command in your environment. Used for running tests, installing packages, executing scripts, making git commits, and any other system operation. Permission patterns in settings.json control which commands are auto-approved.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/tools',
    docLabel: 'Bash tool reference',
    examples: [
      {
        filename: 'Bash permission patterns',
        label: 'Controlling Bash via permissions',
        lang: 'json',
        code: `{
  "permissions": {
    "allow": [
      "Bash(git *)",
      "Bash(npm *)",
      "Bash(python -m pytest *)"
    ],
    "deny": [
      "Bash(rm -rf *)",
      "Bash(git push --force *)",
      "Bash(curl *)"
    ]
  }
}`,
      },
    ],
  },
  {
    id: 'tool-read', label: 'Read/Glob\n/Grep', cat: 'detail', r: 20,
    initiated: 'claude',
    short: 'Read files, find by pattern, search contents — core codebase tools.',
    desc: 'Read, Glob, and Grep form Claude\'s file system interface. Read loads specific files into context. Glob finds files by glob pattern (e.g. **/*.ts). Grep searches file contents with regex and returns matching lines. These are the most-used tools for understanding and navigating codebases.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/tools',
    docLabel: 'File tools reference',
    examples: [
      {
        filename: 'Common patterns',
        label: 'Codebase search patterns',
        lang: 'plaintext',
        code: `Read("src/auth/login.ts")      # load a specific file
Glob("src/**/*.test.ts")       # find all test files
Grep("useEffect", "*.tsx")     # find hook usage
Grep("TODO|FIXME", glob="**")  # find all TODOs

# Best practice: use Grep/Glob to find what you
# need before Read — avoids loading large files
# unnecessarily and saves context tokens.`,
      },
    ],
  },
  {
    id: 'tool-webfetch', label: 'WebFetch\n/Search', cat: 'detail', r: 20,
    initiated: 'claude',
    short: 'Fetch URLs and search the web — access live docs and APIs.',
    desc: 'WebFetch retrieves a URL and converts HTML to markdown for Claude to analyze. WebSearch queries the web and returns ranked results. Both let Claude access live documentation, release notes, API specs, and web resources during a session without leaving the terminal.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/tools',
    docLabel: 'Web tools reference',
    examples: [
      {
        filename: 'Web tool usage',
        label: 'Accessing live documentation',
        lang: 'plaintext',
        code: `WebFetch("https://docs.anthropic.com/...")
# → Fetches page, converts HTML to markdown
# → Claude reads and analyzes the content

WebSearch("React 19 breaking changes 2026")
# → Returns top search results with titles + URLs
# → Claude picks relevant results to fetch

# Common uses:
# - Check current API docs before writing code
# - Research library versions and breaking changes
# - Validate code patterns against official docs`,
      },
    ],
  },
  {
    id: 'tool-task', label: 'Task\nTool', cat: 'detail', r: 20,
    initiated: 'claude',
    short: 'Spawn a subagent with isolated context to handle a parallel subtask.',
    desc: 'The Task tool spawns a child agent with its own isolated context window, agentic loop, and tool set. Subagents work independently and return results to the parent when done. Enables genuine parallelism: spawn a code reviewer, QA agent, and researcher simultaneously. Note: each subagent uses roughly 7× more tokens than sequential work.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/sub-agents',
    docLabel: 'Task tool & subagents docs',
    examples: [
      {
        filename: 'When to use Task',
        label: 'Task tool cost/benefit guide',
        lang: 'plaintext',
        code: `USE Task tool when:
  ✓ Work is truly independent and parallelizable
  ✓ You need to protect parent context from growing
  ✓ Specialists (reviewer, QA, researcher) add value

AVOID Task tool when:
  ✗ Work is sequential (each step needs previous)
  ✗ Task is simple (overhead isn't worth it)
  ✗ Budget is tight (~7× more tokens than sequential)

Sweet spot: 3 parallel specialist agents on complex
multi-facet tasks (review + test + document).`,
      },
    ],
  },
  {
    id: 'hook-pretooluse', label: 'PreToolUse', cat: 'detail', r: 20,
    initiated: 'system',
    short: 'Fires before each tool call — can log, validate, or block operations.',
    desc: 'PreToolUse hooks run before Claude executes any tool call. They receive the tool name and inputs as JSON on stdin. They can log the operation, validate inputs, inject context into stdout (which Claude sees), or exit with code 2 to block the tool call with an error message.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/hooks',
    docLabel: 'Hooks guide',
    examples: [
      {
        filename: '.claude/settings.json',
        label: 'PreToolUse — validate before Bash calls',
        lang: 'json',
        code: `{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [{
          "type": "command",
          "command": ".claude/hooks/validate-bash.sh"
        }]
      }
    ]
  }
}`,
      },
      {
        filename: '.claude/hooks/validate-bash.sh',
        label: 'Block rm -rf and push --force',
        lang: 'bash',
        code: `#!/bin/bash
INPUT=$(cat)
CMD=$(echo "$INPUT" | jq -r '.tool_input.command // ""')

# Block destructive commands
if echo "$CMD" | grep -qE 'rm -rf|push --force'; then
  echo "Blocked: '$CMD' requires manual confirmation" >&2
  exit 2  # exit 2 = block the tool call
fi

exit 0`,
      },
    ],
  },
  {
    id: 'hook-posttooluse', label: 'PostToolUse', cat: 'detail', r: 20,
    initiated: 'system',
    short: 'Fires after each tool call — run formatters, log, or transform output.',
    desc: 'PostToolUse hooks run after Claude completes a tool call. They receive the tool name, inputs, and outputs as JSON on stdin. Common uses: auto-run Prettier on files Claude just wrote, log tool usage for auditing, send notifications when long operations complete, or transform tool output before Claude sees it.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/hooks',
    docLabel: 'Hooks guide',
    examples: [
      {
        filename: '.claude/settings.json',
        label: 'PostToolUse — auto-format after writes',
        lang: 'json',
        code: `{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit|MultiEdit",
        "hooks": [{
          "type": "command",
          "command": "prettier --write \\"$TOOL_INPUT_FILE_PATH\\"",
          "timeout": 30
        }]
      }
    ]
  }
}`,
      },
    ],
  },
  {
    id: 'hook-stop', label: 'Stop /\nNotify', cat: 'detail', r: 20,
    initiated: 'system',
    short: 'Fires when Claude finishes or sends a notification — great for cleanup.',
    desc: 'The Stop hook fires when Claude Code ends a session (the agentic loop is complete or you interrupt). Notification hooks fire when Claude wants to alert you during long tasks. Use these for cleanup scripts, sending desktop notifications, logging session summaries, or triggering external workflows.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/hooks',
    docLabel: 'Hooks guide',
    examples: [
      {
        filename: '.claude/settings.json',
        label: 'Stop hook — desktop notification on completion',
        lang: 'json',
        code: `{
  "hooks": {
    "Stop": [
      {
        "hooks": [{
          "type": "command",
          "command": "osascript -e 'display notification \\"Claude finished\\" with title \\"Claude Code\\"'"
        }]
      }
    ],
    "Notification": [
      {
        "hooks": [{
          "type": "command",
          "command": "terminal-notifier -message \\"$CLAUDE_NOTIFICATION\\""
        }]
      }
    ]
  }
}`,
      },
    ],
  },
  {
    id: 'claudemd-project', label: 'Project\nCLAUDE.md', cat: 'detail', r: 20,
    initiated: 'user',
    short: 'Team-shared instructions committed to git — conventions, stack, guardrails.',
    desc: 'The project-level CLAUDE.md lives at the repo root or in .claude/CLAUDE.md. It\'s committed to git and loaded for every team member\'s sessions. Use it for project conventions, stack documentation, and guardrails that everyone on the team should follow.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/memory',
    docLabel: 'CLAUDE.md docs',
    examples: [
      {
        filename: 'CLAUDE.md',
        label: 'Example project CLAUDE.md',
        lang: 'markdown',
        code: `# My Project

## Critical guardrails
- NEVER delete files without confirmation
- NEVER commit secrets or credentials
- Always run \`npm test\` before marking tasks done

## Stack
- TypeScript, React 18, Node 20
- Postgres via Drizzle ORM
- Vitest for tests

## Conventions
- Named exports only — no default exports
- API routes in \`src/routes/\`

@.claude/rules/code-style.md`,
      },
    ],
  },
  {
    id: 'claudemd-global', label: 'Global\nCLAUDE.md', cat: 'detail', r: 20,
    initiated: 'user',
    short: 'Personal instructions at ~/.claude/CLAUDE.md — applies to all projects.',
    desc: 'Your global CLAUDE.md at ~/.claude/CLAUDE.md applies to every Claude Code session across all your projects. Use it for personal preferences, your coding style, and defaults you always want — preferences that shouldn\'t be imposed on teammates. It\'s never committed to git.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/memory',
    docLabel: 'CLAUDE.md docs',
    examples: [
      {
        filename: '~/.claude/CLAUDE.md',
        label: 'Example global personal CLAUDE.md',
        lang: 'markdown',
        code: `# My Personal Preferences

## Communication style
- Be concise — skip preamble and affirmations
- Use bullet points over prose for explanations

## Coding defaults
- TypeScript strict mode always
- Never use \`any\` type without a comment
- Always run tests before saying you're done

## Always remember
- I'm on macOS — use brew, not apt
- My preferred formatter is Prettier`,
      },
    ],
  },
  {
    id: 'claudemd-inheritance', label: 'CLAUDE.md\nInheritance', cat: 'detail', r: 20,
    initiated: 'both',
    short: 'Multiple CLAUDE.md files merge: enterprise → global → project → local.',
    desc: 'Claude Code merges CLAUDE.md from multiple layers in order: enterprise policy (admin-managed, always loaded), global personal (~/.claude/CLAUDE.md + rules/), project shared (.claude/CLAUDE.md + rules/), and local personal (.claude/CLAUDE.local.md). Later layers extend or override earlier ones.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/memory',
    docLabel: 'CLAUDE.md inheritance docs',
    examples: [
      {
        filename: 'CLAUDE.md layers',
        label: 'The full inheritance chain',
        lang: 'plaintext',
        code: `Load order (later = higher priority):

1. Enterprise policy   ← company-wide guardrails (admin)

2. Global personal     ~/.claude/CLAUDE.md
                       + ~/.claude/rules/*.md
   ← your preferences across ALL projects

3. Project shared      .claude/CLAUDE.md
                       + .claude/rules/*.md
   ← team conventions, committed to git

4. Local personal      .claude/CLAUDE.local.md
   ← your private project overrides (gitignored)

All layers are merged into one system prompt.`,
      },
    ],
  },
  {
    id: 'mcp-config', label: 'MCP\nConfig', cat: 'detail', r: 20,
    initiated: 'user',
    short: 'Configure MCP servers in .mcp.json or via the claude mcp CLI.',
    desc: 'MCP server configuration lives in .mcp.json at your repo root or in ~/.claude/mcp.json for global personal servers. Each entry specifies transport (stdio or HTTP/SSE), command/URL, arguments, and environment variables. Manage servers with the claude mcp add/list/remove CLI.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/mcp',
    docLabel: 'MCP configuration docs',
    examples: [
      {
        filename: '.mcp.json',
        label: 'Configuring MCP servers',
        lang: 'json',
        code: `{
  "mcpServers": {
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": { "GITHUB_PERSONAL_ACCESS_TOKEN": "\${GITHUB_TOKEN}" }
    },
    "postgres": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-postgres",
               "postgresql://localhost/mydb"]
    }
  }
}`,
      },
      {
        filename: 'shell',
        label: 'Managing MCP servers via CLI',
        lang: 'bash',
        code: `claude mcp add --transport stdio github \\
  npx -y @modelcontextprotocol/server-github

claude mcp add --transport http notion \\
  https://mcp.notion.com/mcp

claude mcp list
claude mcp remove github`,
      },
    ],
  },
  {
    id: 'mcp-protocol', label: 'MCP\nProtocol', cat: 'detail', r: 20,
    initiated: 'both',
    short: 'Model Context Protocol — the open standard for AI tool extensions.',
    desc: 'The Model Context Protocol (MCP) is an open standard for connecting AI models to external tools and data sources. MCP servers expose tools, resources, and prompts that Claude can call. Any MCP-compatible server — from the community or custom-built — works with Claude Code.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/mcp',
    docLabel: 'MCP protocol docs',
    examples: [
      {
        filename: 'MCP transport options',
        label: 'How MCP servers connect',
        lang: 'plaintext',
        code: `Transport types:

stdio (local)
  Claude spawns a subprocess and communicates
  via stdin/stdout. Best for local tools and
  command-line utilities.

HTTP/SSE (remote)
  Claude connects to a running HTTP server.
  Best for shared team servers and APIs.

Popular community MCP servers:
  @modelcontextprotocol/server-github
  @modelcontextprotocol/server-postgres
  @modelcontextprotocol/server-filesystem
  @modelcontextprotocol/server-brave-search`,
      },
    ],
  },
  {
    id: 'plugin-yaml', label: 'Plugin\nManifest', cat: 'detail', r: 20,
    initiated: 'user',
    short: 'plugin.json in .claude-plugin/ — declares your plugin\'s metadata.',
    desc: 'Every Claude Code plugin needs a plugin.json manifest in a .claude-plugin/ directory at the plugin root. It declares the plugin\'s name, version, description, author, license, and keywords. The manifest is used by marketplaces to list, search, and install plugins.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/plugins',
    docLabel: 'Plugin manifest docs',
    examples: [
      {
        filename: '.claude-plugin/plugin.json',
        label: 'Plugin manifest format',
        lang: 'json',
        code: `{
  "name": "deploy-toolkit",
  "version": "1.2.0",
  "description": "Kubernetes deployment commands and agents",
  "author": {
    "name": "My Org",
    "email": "dev@example.com"
  },
  "license": "MIT",
  "keywords": ["kubernetes", "deployment", "ci-cd"]
}`,
      },
    ],
  },
  {
    id: 'plugin-publish', label: 'Publish\nPlugin', cat: 'detail', r: 20,
    initiated: 'user',
    short: 'Share a plugin via marketplace.json in a Git repo or local directory.',
    desc: 'Publish Claude Code plugins by adding them to a marketplace.json registry — a simple JSON file listing available plugins and their source directories. Host the registry in a Git repo or local path, then register it in settings.json so users can install from it.',
    doc: 'https://docs.anthropic.com/en/docs/claude-code/plugin-marketplaces',
    docLabel: 'Plugin marketplace docs',
    examples: [
      {
        filename: 'marketplace.json',
        label: 'Marketplace registry format',
        lang: 'json',
        code: `{
  "name": "my-org-plugins",
  "owner": { "name": "My Org" },
  "plugins": [
    {
      "name": "code-reviewer",
      "source": "./code-reviewer",
      "description": "Automated code review tools"
    },
    {
      "name": "deploy-helper",
      "source": "./deploy-helper",
      "description": "Kubernetes deployment commands"
    }
  ]
}`,
      },
      {
        filename: '.claude/settings.json',
        label: 'Register a marketplace',
        lang: 'json',
        code: `{
  "plugins": {
    "marketplaces": [
      "github.com/my-org/claude-plugins"
    ],
    "installed": [
      "code-reviewer@my-org",
      "deploy-helper@my-org"
    ]
  }
}`,
      },
    ],
  },
];

const edges = [
  // L1 → L2 category edges
  { from: 'claude-code',   to: 'modes',           label: 'operates in' },
  { from: 'claude-code',   to: 'core-concepts',   label: 'built on' },
  { from: 'claude-code',   to: 'customization',   label: 'extended via' },
  { from: 'claude-code',   to: 'integrations',    label: 'connects to' },
  // L2 → L3 edges
  { from: 'modes',         to: 'interactive-mode', label: '' },
  { from: 'modes',         to: 'plan-mode',         label: '' },
  { from: 'modes',         to: 'headless',          label: '' },
  { from: 'modes',         to: 'agent-mode',        label: '' },
  { from: 'core-concepts', to: 'tools',             label: '' },
  { from: 'core-concepts', to: 'agent',             label: '' },
  { from: 'core-concepts', to: 'context-memory',    label: '' },
  { from: 'core-concepts', to: 'permissions',       label: '' },
  { from: 'customization', to: 'claude-md',         label: '' },
  { from: 'customization', to: 'settings',          label: '' },
  { from: 'customization', to: 'skills',            label: '' },
  { from: 'customization', to: 'hook',              label: '' },
  { from: 'integrations',  to: 'mcp',              label: '' },
  { from: 'integrations',  to: 'plugin',           label: '' },
  { from: 'integrations',  to: 'ide-integrations', label: '' },
  // L3 → L4 edges
  { from: 'tools',     to: 'tool-bash',          label: '' },
  { from: 'tools',     to: 'tool-read',          label: '' },
  { from: 'tools',     to: 'tool-webfetch',      label: '' },
  { from: 'tools',     to: 'tool-task',          label: '' },
  { from: 'agent',     to: 'subagent',           label: 'spawns' },
  { from: 'agent',     to: 'frontmatter',        label: 'configured by' },
  { from: 'skills',    to: 'skill',              label: '' },
  { from: 'skills',    to: 'command',            label: '' },
  { from: 'skills',    to: 'output-style',       label: '' },
  { from: 'skills',    to: 'marketplace',        label: '' },
  { from: 'hook',      to: 'hook-pretooluse',    label: '' },
  { from: 'hook',      to: 'hook-posttooluse',   label: '' },
  { from: 'hook',      to: 'hook-stop',          label: '' },
  { from: 'claude-md', to: 'claudemd-project',      label: '' },
  { from: 'claude-md', to: 'claudemd-global',       label: '' },
  { from: 'claude-md', to: 'claudemd-inheritance',  label: '' },
  { from: 'mcp',       to: 'mcp-config',         label: '' },
  { from: 'mcp',       to: 'mcp-protocol',       label: '' },
  { from: 'plugin',    to: 'plugin-yaml',        label: '' },
  { from: 'plugin',    to: 'plugin-publish',     label: '' },
  // Cross-category reference edges (dashed)
  { from: 'claude-md',   to: 'context-memory', label: 'feeds into', style: 'ref' },
  { from: 'permissions', to: 'tools',           label: 'governs',    style: 'ref' },
  { from: 'hook',        to: 'settings',        label: 'defined in', style: 'ref' },
];

// ═══════════════════════════════════════════════════════════════
// HIERARCHY
// ═══════════════════════════════════════════════════════════════

const CHILDREN = {
  // L1 → L2 categories
  'claude-code':   ['modes', 'core-concepts', 'customization', 'integrations'],
  // L2 → L3 concepts
  'modes':         ['interactive-mode', 'plan-mode', 'headless', 'agent-mode'],
  'core-concepts': ['tools', 'agent', 'context-memory', 'permissions'],
  'customization': ['claude-md', 'settings', 'skills', 'hook'],
  'integrations':  ['mcp', 'plugin', 'ide-integrations'],
  // L3 → L4 details
  'tools':         ['tool-bash', 'tool-read', 'tool-webfetch', 'tool-task'],
  'agent':         ['subagent', 'frontmatter'],
  'skills':        ['skill', 'command', 'output-style', 'marketplace'],
  'hook':          ['hook-pretooluse', 'hook-posttooluse', 'hook-stop'],
  'claude-md':     ['claudemd-project', 'claudemd-global', 'claudemd-inheritance'],
  'mcp':           ['mcp-config', 'mcp-protocol'],
  'plugin':        ['plugin-yaml', 'plugin-publish'],
};

// Initialize every node with animScale and visibility
nodes.forEach(n => {
  n.animScale = n.id === 'claude-code' ? 1 : 0;
  n.visible   = n.id === 'claude-code';
});

let navPath = []; // stack of node ids drilled into, e.g. [] → ['claude-code'] → ['claude-code','customization']

const navBackBtn = document.getElementById('nav-back');

function syncNavUI() {
  if (navPath.length === 0) {
    navBackBtn.style.display = 'none';
  } else {
    navBackBtn.style.display = 'block';
    navBackBtn.textContent = '← back';
  }
}

navBackBtn.addEventListener('click', () => goBack());

function goDeeper(node) {
  // If clicking an ancestor node (already drilled into), show its panel instead of re-drilling
  if (navPath.includes(node.id)) {
    openPanel(node);
    return;
  }
  const children = CHILDREN[node.id] || [];
  if (children.length > 0) {
    // Hide current level siblings
    const parentId = navPath.length > 0 ? navPath[navPath.length - 1] : null;
    const currentSiblings = parentId ? (CHILDREN[parentId] || []) : ['claude-code'];
    currentSiblings.forEach(id => {
      if (id !== node.id) {
        const n = nodes.find(n => n.id === id);
        if (n) n.visible = false;
      }
    });
    // Spawn children near clicked node
    children.forEach(childId => {
      const child = nodes.find(n => n.id === childId);
      if (!child) return;
      child.x  = node.x + (Math.random() - .5) * 20;
      child.y  = node.y + (Math.random() - .5) * 20;
      child.vx = (Math.random() - .5) * 5;
      child.vy = (Math.random() - .5) * 5;
      child.visible = true;
    });
    navPath.push(node.id);
    closePanel();
    syncNavUI();
  } else {
    openPanel(node);  // leaf — show details
  }
}

function goBack() {
  if (panel.classList.contains('open')) { closePanel(); return; }
  if (navPath.length === 0) return;
  const focusedId = navPath[navPath.length - 1];
  // Hide children of current focused node
  (CHILDREN[focusedId] || []).forEach(childId => {
    const child = nodes.find(n => n.id === childId);
    if (child) child.visible = false;
  });
  navPath.pop();
  // Re-show siblings at the level we're returning to
  const parentId = navPath.length > 0 ? navPath[navPath.length - 1] : null;
  const siblings = parentId ? (CHILDREN[parentId] || []) : ['claude-code'];
  siblings.forEach(id => {
    const n = nodes.find(n => n.id === id);
    if (!n || n.visible) return;
    n.vx = 0;
    n.vy = 0;
    n.visible = true;
  });
  syncNavUI();
}

// ═══════════════════════════════════════════════════════════════
// CANVAS SETUP
// ═══════════════════════════════════════════════════════════════

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

function resize() {
  const wrap = document.getElementById('canvas-wrap');
  W = canvas.width = wrap.offsetWidth * devicePixelRatio;
  H = canvas.height = wrap.offsetHeight * devicePixelRatio;
  canvas.style.width = wrap.offsetWidth + 'px';
  canvas.style.height = wrap.offsetHeight + 'px';
  ctx.scale(devicePixelRatio, devicePixelRatio);
}

function getW() { return canvas.width / devicePixelRatio; }
function getH() { return canvas.height / devicePixelRatio; }

resize();

// ═══════════════════════════════════════════════════════════════
// INITIAL LAYOUT
// ═══════════════════════════════════════════════════════════════

function placeNodes() {
  const cx = getW() / 2, cy = getH() / 2;
  const pos = {
    // L1
    'claude-code':        [0,    0],
    // L2 categories
    'modes':              [-190, -110],
    'core-concepts':      [190,  -110],
    'customization':      [-190, 110],
    'integrations':       [190,  110],
    // L3 under modes
    'interactive-mode':   [-290, -200],
    'plan-mode':          [-130, -270],
    'headless':           [60,   -280],
    'agent-mode':         [230,  -220],
    // L3 under core-concepts
    'tools':              [320,  -100],
    'agent':              [350,  0],
    'context-memory':     [310,  110],
    'permissions':        [240,  210],
    // L3 under customization
    'claude-md':          [-340, 60],
    'settings':           [-370, -20],
    'skills':             [-350, -130],
    'hook':               [-260, 220],
    // L3 under integrations
    'mcp':                [100,  300],
    'plugin':             [270,  320],
    'ide-integrations':   [400,  240],
    // L4 under agent
    'subagent':           [420,  -60],
    'frontmatter':        [440,  50],
    // L4 under skills
    'skill':              [-420, -160],
    'command':            [-430, -70],
    'output-style':       [-410, -250],
    'marketplace':        [-320, -310],
    // L4 under tools
    'tool-bash':          [420,  -150],
    'tool-read':          [450,  -60],
    'tool-webfetch':      [450,  40],
    'tool-task':          [410,  140],
    // L4 under hook
    'hook-pretooluse':    [-340, 300],
    'hook-posttooluse':   [-220, 340],
    'hook-stop':          [-100, 360],
    // L4 under claude-md
    'claudemd-project':   [-450, 130],
    'claudemd-global':    [-470, 30],
    'claudemd-inheritance':[-450, -80],
    // L4 under mcp
    'mcp-config':         [60,   400],
    'mcp-protocol':       [210,  430],
    // L4 under plugin
    'plugin-yaml':        [380,  400],
    'plugin-publish':     [470,  330],
  };
  nodes.forEach(n => {
    const p = pos[n.id];
    n.x  = cx + (p ? p[0] : (Math.random() - .5) * 400);
    n.y  = cy + (p ? p[1] : (Math.random() - .5) * 400);
    n.vx = 0; n.vy = 0;
  });
}
placeNodes();

window.addEventListener('resize', () => {
  ctx.resetTransform();
  resize();
  placeNodes();
});

// ═══════════════════════════════════════════════════════════════
// PHYSICS
// ═══════════════════════════════════════════════════════════════

function tick() {
  const cw = getW(), ch = getH();

  // Animate scale for all nodes
  nodes.forEach(n => {
    const target = n.visible ? 1 : 0;
    n.animScale += (target - n.animScale) * 0.1;
    if (Math.abs(n.animScale - target) < 0.004) n.animScale = target;
  });

  const active = nodes.filter(n => n.animScale > 0.05);

  // Repulsion between active pairs
  for (let i = 0; i < active.length; i++) {
    for (let j = i + 1; j < active.length; j++) {
      const a = active[i], b = active[j];
      const dx = b.x - a.x, dy = b.y - a.y;
      const dist = Math.sqrt(dx * dx + dy * dy) || 1;
      const minD = (a.r + b.r) * 3.0;
      if (dist < minD) {
        const f = (minD - dist) / dist * 0.1;
        if (!a.dragging) { a.vx -= dx * f; a.vy -= dy * f; }
        if (!b.dragging) { b.vx += dx * f; b.vy += dy * f; }
      }
    }
  }

  // Spring along edges (only between active nodes)
  edges.forEach(e => {
    const a = nodes.find(n => n.id === e.from);
    const b = nodes.find(n => n.id === e.to);
    if (!a || !b || a.animScale < 0.05 || b.animScale < 0.05) return;
    const dx = b.x - a.x, dy = b.y - a.y;
    const dist = Math.sqrt(dx * dx + dy * dy) || 1;
    const target = (a.r + b.r) * 2.8 + 30;
    const f = (dist - target) / dist * 0.035;
    if (!a.dragging) { a.vx += dx * f; a.vy += dy * f; }
    if (!b.dragging) { b.vx -= dx * f; b.vy -= dy * f; }
  });

  // Gravity to center + damping + bounds (active only)
  active.forEach(n => {
    if (n.dragging) return;
    n.vx += (cw / 2 - n.x) * 0.0015;
    n.vy += (ch / 2 - n.y) * 0.0015;
    n.vx *= 0.84; n.vy *= 0.84;
    n.x += n.vx; n.y += n.vy;
    n.x = Math.max(n.r + 8, Math.min(cw - n.r - 8, n.x));
    n.y = Math.max(n.r + 8, Math.min(ch - n.r - 8, n.y));
  });
}

// ═══════════════════════════════════════════════════════════════
// DRAW
// ═══════════════════════════════════════════════════════════════

let hoveredNode = null, selectedNode = null;
let pulseT = 0;

function isConnected(ref, node) {
  return edges.some(e =>
    (e.from === ref.id && e.to === node.id) ||
    (e.to   === ref.id && e.from === node.id) ||
    node.id === ref.id
  );
}

function drawBgGrid() {
  ctx.save();
  ctx.strokeStyle = cssVar('--border');
  ctx.lineWidth = 1;
  const step = 32;
  const cw = getW(), ch = getH();
  for (let x = step; x < cw; x += step) {
    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, ch); ctx.stroke();
  }
  for (let y = step; y < ch; y += step) {
    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(cw, y); ctx.stroke();
  }
  ctx.restore();
}

function drawEdge(a, b, alpha, color, lineWidth, dashed) {
  const dx = b.x - a.x, dy = b.y - a.y;
  const dist = Math.sqrt(dx * dx + dy * dy) || 1;
  const ux = dx / dist, uy = dy / dist;

  // Slight perpendicular curve
  const mx = (a.x + b.x) / 2;
  const my = (a.y + b.y) / 2;
  const offset = dist * 0.08;
  const cpx = mx - uy * offset;
  const cpy = my + ux * offset;

  // Clip to circle edges
  const sx = a.x + ux * (a.r + 2);
  const sy = a.y + uy * (a.r + 2);
  const ex = b.x - ux * (b.r + 7);
  const ey = b.y - uy * (b.r + 7);

  ctx.save();
  ctx.globalAlpha = alpha;
  ctx.strokeStyle = color;
  ctx.lineWidth = lineWidth;
  if (dashed) ctx.setLineDash([5, 4]); else ctx.setLineDash([]);
  ctx.beginPath();
  ctx.moveTo(sx, sy);
  ctx.quadraticCurveTo(cpx, cpy, ex, ey);
  ctx.stroke();
  ctx.setLineDash([]);

  // Arrow head
  const angle = Math.atan2(ey - cpy, ex - cpx);
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.moveTo(ex, ey);
  ctx.lineTo(ex - 8 * Math.cos(angle - 0.4), ey - 8 * Math.sin(angle - 0.4));
  ctx.lineTo(ex - 8 * Math.cos(angle + 0.4), ey - 8 * Math.sin(angle + 0.4));
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}

function drawNavUI() {
  const cw = getW(), ch = getH();

  // "click to explore" hint at root level
  if (navPath.length === 0) {
    const cc = nodes.find(n => n.id === 'claude-code');
    if (cc) {
      ctx.save();
      ctx.font = '400 10px "JetBrains Mono", monospace';
      ctx.fillStyle = cssVar('--muted');
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.fillText('click to explore', cc.x, cc.y + cc.r + 14);
      ctx.restore();
    }
  }

  // Breadcrumb trail at top of canvas when drilled in
  if (navPath.length > 0) {
    const crumbs = ['Claude Code', ...navPath.map(id => {
      const n = nodes.find(n => n.id === id);
      return n ? n.label.replace(/\n/g, ' ') : id;
    })];
    const crumb = crumbs.join(' › ');
    ctx.save();
    ctx.font = '400 9px "JetBrains Mono", monospace';
    ctx.fillStyle = cssVar('--muted');
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.fillText(crumb, cw / 2, 14);
    ctx.restore();
  }
}

function draw() {
  const cw = getW(), ch = getH();
  ctx.clearRect(0, 0, cw, ch);
  pulseT += 0.018;

  drawBgGrid();

  const activeRef = selectedNode || hoveredNode;

  // ── Edges (only between sufficiently visible nodes) ────
  edges.forEach(e => {
    const a = nodes.find(n => n.id === e.from);
    const b = nodes.find(n => n.id === e.to);
    if (!a || !b) return;
    const ea = Math.min(a.animScale, b.animScale);
    if (ea < 0.05) return;

    const active = activeRef
      ? (activeRef.id === a.id || activeRef.id === b.id)
      : false;
    const dim = activeRef && !active;

    const dashed = e.style === 'ref';
    if (dim) {
      drawEdge(a, b, 0.04 * ea, '#8b949e', 1, dashed);
    } else if (active) {
      drawEdge(a, b, 0.55 * ea, COLORS[a.cat], 1.5, dashed);
    } else {
      drawEdge(a, b, 0.35 * ea, 'rgba(212,168,83,0.6)', 1.2, dashed);
    }
  });

  // ── Nodes ──────────────────────────────────────────────
  nodes.forEach(n => {
    if (n.animScale < 0.005) return;

    const color = COLORS[n.cat];
    const isSelected = selectedNode && selectedNode.id === n.id;
    const isHovered  = !selectedNode && hoveredNode && hoveredNode.id === n.id;
    const connected  = activeRef ? isConnected(activeRef, n) : false;
    const dim        = activeRef && !connected;

    // Scale transform centred on the node
    ctx.save();
    ctx.translate(n.x, n.y);
    ctx.scale(n.animScale, n.animScale);
    ctx.translate(-n.x, -n.y);
    ctx.globalAlpha = (dim ? 0.18 : 1) * n.animScale;

    // Pulse ring on claude-code
    if (n.id === 'claude-code' && !dim) {
      const pr = n.r + 12 + 10 * Math.sin(pulseT);
      const pulse = ctx.createRadialGradient(n.x, n.y, n.r, n.x, n.y, pr + 6);
      pulse.addColorStop(0, color + '30');
      pulse.addColorStop(1, 'transparent');
      ctx.fillStyle = pulse;
      ctx.beginPath();
      ctx.arc(n.x, n.y, pr + 6, 0, Math.PI * 2);
      ctx.fill();
    }

    // Glow halo
    if ((isSelected || isHovered) && !dim) {
      ctx.save();
      ctx.shadowBlur = 24;
      ctx.shadowColor = color + '88';
      const grd = ctx.createRadialGradient(n.x, n.y, n.r * 0.5, n.x, n.y, n.r * 2.4);
      grd.addColorStop(0, color + '28');
      grd.addColorStop(1, 'transparent');
      ctx.fillStyle = grd;
      ctx.beginPath();
      ctx.arc(n.x, n.y, n.r * 2.4, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    // Circle fill
    ctx.beginPath();
    ctx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
    ctx.fillStyle = isSelected ? color + 'ee'
                  : isHovered  ? color + 'cc'
                  : connected && activeRef ? color + '40'
                  : color + '28';
    ctx.fill();

    // Circle stroke
    ctx.save();
    if (isSelected) { ctx.shadowBlur = 12; ctx.shadowColor = color; }
    ctx.strokeStyle = color + (isSelected ? 'ff' : isHovered ? 'ee' : connected && activeRef ? 'cc' : 'aa');
    ctx.lineWidth = isSelected ? 2.5 : isHovered ? 2 : 1.5;
    ctx.beginPath();
    ctx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
    ctx.stroke();
    ctx.restore();

    // Label
    const lines = n.label.split('\n');
    const fs = Math.max(9, n.r * 0.34);
    ctx.font = `${isSelected || isHovered ? 500 : 400} ${fs}px "JetBrains Mono", monospace`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = isSelected ? cssVar('--bg')
                  : dim        ? cssVar('--muted')
                  : isHovered  ? cssVar('--text')
                  : cssVar('--dim');
    const lh = fs * 1.3;
    lines.forEach((line, i) => {
      ctx.fillText(line, n.x, n.y + (i - (lines.length - 1) / 2) * lh);
    });

    ctx.restore(); // restores transform + globalAlpha
  });

  drawNavUI();
}

function cssVar(name) {
  return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
}

function loop() { tick(); draw(); requestAnimationFrame(loop); }

// Wait for fonts before starting
document.fonts.ready.then(() => loop());

// ═══════════════════════════════════════════════════════════════
// PANEL
// ═══════════════════════════════════════════════════════════════

const panel    = document.getElementById('panel');
const pCat     = document.getElementById('p-cat');
const pTitle   = document.getElementById('p-title');
const pBadges  = document.getElementById('p-badges');
const pDesc    = document.getElementById('p-desc');
const pDoclink = document.getElementById('p-doclink');
const pExamples= document.getElementById('p-examples');
const pRelated = document.getElementById('p-related');

function langFromFilename(filename) {
  if (/\.json$/.test(filename)) return 'json';
  if (/\.md$/.test(filename))   return 'markdown';
  if (/\.sh$|shell/.test(filename)) return 'bash';
  if (/\.ya?ml$/.test(filename)) return 'yaml';
  if (/\.js$/.test(filename))   return 'javascript';
  if (/\.ts$/.test(filename))   return 'typescript';
  if (/\.py$/.test(filename))   return 'python';
  return 'plaintext';
}

function openPanel(node) {
  selectedNode = node;

  const color = COLORS[node.cat];

  // Category label
  pCat.textContent = CAT_LABELS[node.cat];
  pCat.style.color = color;

  // Title
  pTitle.textContent = node.label.replace('\n', ' ');

  // Badges
  pBadges.innerHTML = '';
  const ic = INITIATED[node.initiated];
  if (ic) {
    const b1 = document.createElement('span');
    b1.className = `badge ${ic.cls}`;
    b1.title = ic.tip;
    b1.textContent = ic.label;
    pBadges.appendChild(b1);
  }
  const b2 = document.createElement('span');
  b2.className = 'badge badge-cat';
  b2.style.cssText = `border-color:${color}55;color:${color};background:${color}11`;
  b2.textContent = CAT_LABELS[node.cat];
  pBadges.appendChild(b2);

  // Description
  pDesc.textContent = node.desc;

  // Doc link
  pDoclink.innerHTML = node.doc ? `
    <a class="p-doc-link" href="${node.doc}" target="_blank" rel="noopener">
      <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
        <path d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"/>
      </svg>
      ${node.docLabel || 'Official documentation'}
    </a>` : '';

  // Code examples
  pExamples.innerHTML = '';
  (node.examples || []).forEach((ex, idx) => {
    const lang = ex.lang || langFromFilename(ex.filename);

    const wrap = document.createElement('div');
    wrap.className = 'code-block';

    const head = document.createElement('div');
    head.className = 'cb-head';
    head.innerHTML = `
      <div class="cb-label">
        <svg width="11" height="11" viewBox="0 0 16 16" fill="${color}" style="flex-shrink:0;opacity:.7">
          <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688Z"/>
        </svg>
        <span class="cb-filename">${ex.filename}</span>
        <span style="color:var(--border2)">·</span>
        <span class="cb-sublabel">${ex.label}</span>
      </div>
      <span class="cb-chevron ${idx === 0 ? 'open' : ''}">▶</span>`;

    const body = document.createElement('div');
    body.className = `cb-body ${idx === 0 ? 'open' : ''}`;

    const pre  = document.createElement('pre');
    const code = document.createElement('code');
    code.textContent = ex.code;
    if (lang !== 'plaintext') code.className = `language-${lang}`;
    pre.appendChild(code);
    body.appendChild(pre);

    // Syntax highlight + copy button
    try { hljs.highlightElement(code); } catch (e) {}
    head.appendChild(makeCopyBtn(code, true));

    head.addEventListener('click', () => {
      const isOpen = body.classList.toggle('open');
      head.querySelector('.cb-chevron').classList.toggle('open', isOpen);
    });

    wrap.appendChild(head);
    wrap.appendChild(body);
    pExamples.appendChild(wrap);
  });

  // Related concepts
  const related = new Set();
  edges.forEach(e => {
    if (e.from === node.id) related.add(e.to);
    if (e.to   === node.id) related.add(e.from);
  });
  if (related.size) {
    pRelated.innerHTML = '<div class="p-related-title">Related concepts</div><div class="chips"></div>';
    const chipsEl = pRelated.querySelector('.chips');
    related.forEach(id => {
      const rel = nodes.find(n => n.id === id);
      if (!rel) return;
      const chip = document.createElement('span');
      chip.className = 'chip';
      chip.textContent = rel.label.replace('\n', ' ');
      chip.addEventListener('click', () => openPanel(rel));
      chipsEl.appendChild(chip);
    });
  } else {
    pRelated.innerHTML = '';
  }

  panel.classList.add('open');
}

function closePanel() {
  panel.classList.remove('open');
  selectedNode = null;
}

document.getElementById('p-close').addEventListener('click', closePanel);

// ═══════════════════════════════════════════════════════════════
// INTERACTION
// ═══════════════════════════════════════════════════════════════

const tooltip  = document.getElementById('tooltip');
const ttName   = document.getElementById('tt-name');
const ttDesc   = document.getElementById('tt-desc');
const ttCat    = document.getElementById('tt-cat');

let dragging = null, dragOffX = 0, dragOffY = 0;
let mouseDownNode = null, mouseDownTime = 0;

function getNodeAt(mx, my) {
  return nodes.find(n => n.animScale > 0.5 && Math.hypot(n.x - mx, n.y - my) < n.r) || null;
}

canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  if (dragging) {
    dragging.x = mx + dragOffX;
    dragging.y = my + dragOffY;
    return;
  }

  hoveredNode = getNodeAt(mx, my);

  if (hoveredNode && hoveredNode !== selectedNode) {
    canvas.style.cursor = 'pointer';
    const color = COLORS[hoveredNode.cat];
    ttName.textContent = hoveredNode.label.replace('\n', ' ');
    ttName.style.color = color;
    ttDesc.textContent = hoveredNode.short;
    const hasChildren = !!(CHILDREN[hoveredNode.id]?.length);
    const isRoot = navPath.length === 0 && hoveredNode.id === 'claude-code';
    ttCat.textContent = (isRoot || hasChildren)
      ? `${CAT_LABELS[hoveredNode.cat] || hoveredNode.cat} · click to expand →`
      : `${CAT_LABELS[hoveredNode.cat] || hoveredNode.cat} · click for details →`;
    tooltip.style.opacity = '1';
    let tx = e.clientX + 16, ty = e.clientY - 10;
    if (tx + 250 > window.innerWidth)  tx = e.clientX - 266;
    if (ty + 100 > window.innerHeight) ty = e.clientY - 100;
    tooltip.style.left = tx + 'px';
    tooltip.style.top  = ty + 'px';
  } else {
    canvas.style.cursor = 'default';
    tooltip.style.opacity = '0';
  }
});

canvas.addEventListener('mousedown', e => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;
  mouseDownNode = getNodeAt(mx, my);
  mouseDownTime = Date.now();
  if (mouseDownNode) {
    dragOffX = mouseDownNode.x - mx;
    dragOffY = mouseDownNode.y - my;
    dragging = mouseDownNode;
    dragging.dragging = true;
    canvas.style.cursor = 'grabbing';
  }
});

canvas.addEventListener('mouseup', e => {
  const elapsed = Date.now() - mouseDownTime;
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;
  const upNode = getNodeAt(mx, my);

  if (dragging) {
    dragging.dragging = false;
    dragging.vx = 0; dragging.vy = 0;
    dragging = null;
  }

  // Short press = click
  if (elapsed < 250 && upNode && upNode === mouseDownNode) {
    tooltip.style.opacity = '0';
    goDeeper(upNode);
  } else if (elapsed < 250 && !upNode && selectedNode) {
    closePanel();
  }

  canvas.style.cursor = hoveredNode ? 'pointer' : 'default';
  mouseDownNode = null;
});

// (close panel / back button handled in mouseup)

canvas.addEventListener('mouseleave', () => {
  tooltip.style.opacity = '0';
  if (dragging) { dragging.dragging = false; dragging = null; }
  hoveredNode = null;
});

// ═══════════════════════════════════════════════════════════════
// TABS
// ═══════════════════════════════════════════════════════════════

const canvasWrap = document.getElementById('canvas-wrap');
const refPanel   = document.getElementById('ref-panel');
const legend     = document.getElementById('legend');
const hint       = document.getElementById('topbar-hint');

document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    if (btn.dataset.tab === 'graph') {
      canvasWrap.style.display = '';
      legend.style.display = '';
      hint.style.display = '';
      refPanel.classList.remove('active');
    } else {
      canvasWrap.style.display = 'none';
      legend.style.display = 'none';
      hint.style.display = 'none';
      refPanel.classList.add('active');
      closePanel();
      tooltip.style.opacity = '0';
      // Highlight any unhighlighted code blocks on first view
      refPanel.querySelectorAll('pre code:not(.hljs)').forEach(el => {
        try { hljs.highlightElement(el); } catch(e) {}
      });
    }
  });
});

// ═══════════════════════════════════════════════════════════════
// PANEL RESIZE
// ═══════════════════════════════════════════════════════════════

(function () {
  const handle = document.getElementById('panel-resize');
  let startX, startW;

  handle.addEventListener('mousedown', e => {
    startX = e.clientX;
    startW = panel.offsetWidth;
    panel.classList.add('resizing');
    document.body.classList.add('panel-resizing');
    e.preventDefault();
  });

  document.addEventListener('mousemove', e => {
    if (!panel.classList.contains('resizing')) return;
    const delta = startX - e.clientX;
    const newW  = Math.min(Math.max(startW + delta, 300), window.innerWidth * 0.80);
    panel.style.width = newW + 'px';
  });

  document.addEventListener('mouseup', () => {
    panel.classList.remove('resizing');
    document.body.classList.remove('panel-resizing');
  });
})();

// ═══════════════════════════════════════════════════════════════
// COPY BUTTONS
// ═══════════════════════════════════════════════════════════════

function makeCopyBtn(codeEl, stopProp) {
  const btn = document.createElement('button');
  btn.className = 'copy-btn';
  btn.textContent = 'copy';
  btn.addEventListener('click', e => {
    if (stopProp) e.stopPropagation();
    const text = codeEl.innerText;
    navigator.clipboard.writeText(text).then(() => {
      btn.textContent = 'copied ✓';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'copy';
        btn.classList.remove('copied');
      }, 2000);
    });
  });
  return btn;
}

// Reference panel — static blocks, wire up once
document.querySelectorAll('.ref-code-block').forEach(block => {
  const header = block.querySelector('.ref-code-block-header');
  const code   = block.querySelector('pre code');
  if (header && code) header.appendChild(makeCopyBtn(code, false));
});

// ═══════════════════════════════════════════════════════════════
// LOOP DIAGRAM ANIMATION
// ═══════════════════════════════════════════════════════════════

const ldSteps = [
  { id: 'ld-you',    color: '#5a8fc4' },
  { id: 'ld-claude', color: '#d4a853' },
  { id: 'ld-tool',   color: '#c46e5a' },
  { id: 'ld-result', color: '#5ea878' },
];

function setLdActive(stepIdx) {
  ldSteps.forEach(({ id, color }, i) => {
    const g = document.getElementById(id);
    if (!g) return;
    const rect = g.querySelector('rect');
    const text = g.querySelector('text');
    if (i === stepIdx) {
      rect.setAttribute('stroke', color);
      rect.setAttribute('fill', color + '18');
      text.setAttribute('fill', color);
    } else {
      rect.setAttribute('stroke', '#1b2235');
      rect.setAttribute('fill', '#0e1220');
      text.setAttribute('fill', '#7d7566');
    }
  });

  // Also light up the loop arrow when going from result back to claude
  const loopPath = document.getElementById('loop-path');
  if (loopPath) {
    loopPath.setAttribute('stroke', stepIdx === 3 ? '#5ea878' : '#2a3448');
  }
}

let ldStep = 0;
setInterval(() => {
  setLdActive(ldStep);
  ldStep = (ldStep + 1) % ldSteps.length;
}, 1100);

// ═══════════════════════════════════════════════════════════════
// THEME
// ═══════════════════════════════════════════════════════════════

(function() {
  const root = document.documentElement;
  const saved = localStorage.getItem('cc-theme') || 'dark';
  root.setAttribute('data-theme', saved);

  // Sync active state on initial load
  document.querySelectorAll('.theme-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.mode === saved);
    btn.addEventListener('click', () => {
      const mode = btn.dataset.mode;
      root.setAttribute('data-theme', mode);
      localStorage.setItem('cc-theme', mode);
      document.querySelectorAll('.theme-btn').forEach(b =>
        b.classList.toggle('active', b === btn)
      );
    });
  });
})();
</script>
</body>
</html>
